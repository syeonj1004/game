<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>술래잡기기</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #e6ccff;
      color: #fff;
      font-family: sans-serif;
    }
    canvas {
      display: block;
      margin: auto;
$1
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="800" height="600"></canvas>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const player1 = { x: 100, y: 100, width: 40, height: 40, dx: 0, dy: 0, score: 0, name: "Red", emoji: "😡", speed: 4 };
    const player2 = { x: 600, y: 400, width: 40, height: 40, dx: 0, dy: 0, score: 0, name: "Blue", emoji: "🥶", speed: 4 };
    let tagger = player1;
    let lastTagTime = Date.now();
    const TAG_TIME_LIMIT = 15000;

    const keys = {};
    document.addEventListener("keydown", (e) => keys[e.key] = true);
    document.addEventListener("keyup", (e) => keys[e.key] = false);

    function assignRandomSpeeds() {
      const speeds = [0.75, 1.0, 1.25];
      const shuffled = speeds.sort(() => Math.random() - 0.5);
      tagger.speed = 4 * shuffled[0];
      const other = tagger === player1 ? player2 : player1;
      other.speed = 4 * shuffled[1];
    }

    function updatePlayerMovement() {
      player1.dx = (keys["d"] ? player1.speed : 0) - (keys["a"] ? player1.speed : 0);
      player1.dy = (keys["s"] ? player1.speed : 0) - (keys["w"] ? player1.speed : 0);
      player2.dx = (keys["ArrowRight"] ? player2.speed : 0) - (keys["ArrowLeft"] ? player2.speed : 0);
      player2.dy = (keys["ArrowDown"] ? player2.speed : 0) - (keys["ArrowUp"] ? player2.speed : 0);
    }

    function movePlayers() {
  player1.x += player1.dx;
  player1.y += player1.dy;
  player2.x += player2.dx;
  player2.y += player2.dy;

  // player1 경계 제한
  player1.x = Math.max(0, Math.min(canvas.width - player1.width, player1.x));
  player1.y = Math.max(0, Math.min(canvas.height - player1.height, player1.y));
  // player2 경계 제한
  player2.x = Math.max(0, Math.min(canvas.width - player2.width, player2.x));
  player2.y = Math.max(0, Math.min(canvas.height - player2.height, player2.y));
}

    function checkCollision(p1, p2) {
      return p1.x < p2.x + p2.width &&
             p1.x + p1.width > p2.x &&
             p1.y < p2.y + p2.height &&
             p1.y + p1.height > p2.y;
    }

    function drawPlayer(p) {
      ctx.font = "32px sans-serif";
      ctx.textAlign = "center";
      ctx.textBaseline = "middle";
      ctx.fillText(p.emoji, p.x + p.width / 2, p.y + p.height / 2);

      ctx.fillStyle = "white";
      ctx.font = "12px sans-serif";
      ctx.fillText(p.name + (tagger === p ? " (술래)" : ""), p.x + p.width / 2, p.y - 10);
      ctx.fillText(`점수: ${p.score}`, p.x + p.width / 2, p.y + p.height + 10);
    }

    function drawScore() {
      const timeLeft = Math.max(0, 15000 - (Date.now() - lastTagTime));
      ctx.fillText(`남은 시간: ${(timeLeft / 1000).toFixed(1)}초`, 600, 30);
    }

    function resetPositions() {
      player1.x = 100; player1.y = 100;
      player2.x = 600; player2.y = 400;
      lastTagTime = Date.now();
      assignRandomSpeeds();
    }

    function gameOver(winner) {
      alert(`${winner} 승리!`);
      player1.score = 0;
      player2.score = 0;
      tagger = player1;
      assignRandomSpeeds();
      resetPositions();
    }

    function update() {
      updatePlayerMovement();
      movePlayers();
      let catcher = tagger;
      let target = tagger === player1 ? player2 : player1;

      if (checkCollision(catcher, target)) {
        catcher.score++;
        if (catcher.score >= 5) return gameOver(catcher.name);
        tagger = target;
        assignRandomSpeeds();
        resetPositions();
      }

      if (Date.now() - lastTagTime > TAG_TIME_LIMIT) {
        catcher.score--; // 마이너스 점수 허용
        tagger = target;
        assignRandomSpeeds();
        resetPositions();
      }
    }

    function draw() {
      ctx.fillStyle = 'rgba(218, 0, 255, 0.2)';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      drawPlayer(player1);
      drawPlayer(player2);
      drawScore();
    }

    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    assignRandomSpeeds();
    loop();
  </script>
</body>
</html>
