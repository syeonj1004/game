<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì•„ë¦°ì´ì˜ ê²Œì„</title>
  <style>
    body { margin:0; padding:0; text-align:center; background:#222; color:#fff; font-family: monospace; }
    /* ì‹œì‘ í™”ë©´ ë°°ê²½ */
    #titleScreen { display:flex; flex-direction:column; align-items:center; justify-content:center; height:100vh;
                   background:url('title_bg.png') no-repeat center bottom; background-size:cover; position:relative; }
    #titleScreen h1 { color:purple; font-size:48px; margin-bottom:20px; }
    #titleScreen .speech { position:absolute; top:20%; right:20%; background:#fff; color:#000; padding:10px; border-radius:10px;
                           font-size:18px; font-family:sans-serif; }
    /* ê²Œì„ ì»¨í…Œì´ë„ˆ */
    #gameContainer { display:none; position:relative; margin:20px auto; width:800px; height:600px; border:2px solid #fff; background:#111; }
    #gameCanvas { display:block; margin:0 auto; background:#333; }
    button { margin:10px 5px; padding:10px 20px; font-size:18px; cursor:pointer; }
    #nextStageButton, #quitButton { display:none; }
  </style>
</head>
<body>
  <!-- ì‹œì‘ í™”ë©´ -->
  <div id="titleScreen">
    <h1>â˜†ì•„ë¦°ì´ì˜ ê²Œì„â˜†</h1>
    <div class="speech">ë¨¹ì´ë¥¼ ì£¼ì„¸ìš”!</div>
    <button id="startButton">ì‹œì‘</button>
  </div>

  <!-- ê²Œì„ í™”ë©´ -->
  <div id="gameContainer">
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div id="scoreboard" style="position:absolute; top:10px; left:10px; font-size:24px;">ì ìˆ˜: 0 &nbsp; ë‚¨ì€ ì‹œê°„: 0</div>
  </div>

  <!-- ë²„íŠ¼ -->
  <button id="nextStageButton">ë‹¤ìŒ ë‹¨ê³„</button>
  <button id="quitButton">ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
  <audio id="bgMusic" src="golden.mp3" loop></audio>

  <script>
    const titleScreen = document.getElementById('titleScreen');
    const gameContainer = document.getElementById('gameContainer');
    const startButton = document.getElementById('startButton');
    const nextStageButton = document.getElementById('nextStageButton');
    const quitButton = document.getElementById('quitButton');
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreboard = document.getElementById('scoreboard');
    const bgMusic = document.getElementById('bgMusic');

    // ì„¤ì •ê°’
    const HAMSTER_SIZE = 32;
    const SEED_SIZE = 16;
    const OBSTACLE_SIZE = 32;
    const TARGET_SEEDS = 20;
    const LEVEL1_TIME = 60;          // 1ë‹¨ê³„ ì œí•œì‹œê°„
    const STAGE_DECREMENT = 10;      // ë‹¨ê³„ë³„ ì‹œê°„ ê°ì†ŒëŸ‰
    const MAX_STAGE = 4;             // ìµœëŒ€ ë‹¨ê³„ ìˆ˜

    let hamster = { x:100, y:0, vy:0, onGround:true };
    let seeds = [], obstacles = [];
    let keys = {}, score = 0, timeLeft = 0;
    let timerInterval, gameRunning = false, currentStage = 1;

    // íƒ€ì´í‹€ -> ê²Œì„ í™”ë©´ ì „í™˜
    function showGame() {
      titleScreen.style.display = 'none';
      gameContainer.style.display = 'block';
    }

    // ë‹¨ê³„ ì´ˆê¸°í™”
    function setupStage(stage) {
      const groundY = canvas.height - HAMSTER_SIZE - 50;
      hamster = { x:100, y:groundY, vy:0, onGround:true };
      seeds = [];
      for (let i = 0; i < TARGET_SEEDS; i++) {
        seeds.push({
          x: Math.random()*(canvas.width - SEED_SIZE),
          y: groundY - Math.random()*150
        });
      }
      obstacles = [];
      for (let i = 0; i < 15; i++) {
        obstacles.push({
          x: Math.random()*(canvas.width - OBSTACLE_SIZE),
          y: groundY - OBSTACLE_SIZE,
          width: OBSTACLE_SIZE, height: OBSTACLE_SIZE
        });
      }
      score = 0;
      timeLeft = Math.max(10, LEVEL1_TIME - (stage-1)*STAGE_DECREMENT);
      updateScoreboard();
    }

    function updateScoreboard() {
      scoreboard.textContent = `ë‹¨ê³„ ${currentStage}/${MAX_STAGE} - ì ìˆ˜: ${score}/${TARGET_SEEDS} &nbsp; ë‚¨ì€ ì‹œê°„: ${timeLeft.toFixed(1)}s`;
    }

    // íƒ€ì´ë¨¸ ì‹œì‘
    function startTimer() {
      clearInterval(timerInterval);
      timerInterval = setInterval(() => {
        timeLeft -= 0.1;
        if (timeLeft <= 0) endGame(false);
        updateScoreboard();
      }, 100);
    }

    // ë‹¨ê³„ ì‹œì‘
    function startStage(stage) {
      currentStage = stage;
      setupStage(stage);
      startTimer();
      bgMusic.play();
      gameRunning = true;
      nextStageButton.style.display = 'none';
      quitButton.style.display = 'none';
      requestAnimationFrame(gameLoop);
    }

    // ì‹œì‘ ë²„íŠ¼
    startButton.addEventListener('click', () => {
      showGame();
      startStage(1);
    });

    // ë‹¤ìŒ ë‹¨ê³„ ë²„íŠ¼
    nextStageButton.addEventListener('click', () => {
      startStage(currentStage+1);
    });

    // ê·¸ë§Œí•˜ê¸° ë²„íŠ¼
    quitButton.addEventListener('click', () => {
      location.reload();
    });

    // ê²Œì„ ì¢…ë£Œ
    function endGame(win) {
      gameRunning = false;
      clearInterval(timerInterval);
      bgMusic.pause();
      if (win) {
        if (currentStage >= MAX_STAGE) {
          alert(`ìµœì¢… ìŠ¹ë¦¬! ${MAX_STAGE}ë‹¨ê³„ ì™„ë£Œ`);
          quitButton.style.display = 'inline-block';
        } else {
          alert(`ğŸ‰ ë‹¨ê³„ ${currentStage} í´ë¦¬ì–´!`);
          nextStageButton.style.display = 'inline-block';
        }
      } else {
        alert('â° ì‹œê°„ ì¢…ë£Œ! ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.');
        titleScreen.style.display = 'flex';
      }
    }

    // ê²Œì„ ë£¨í”„
    function gameLoop() {
      if (!gameRunning) return;
      update(); draw();
      requestAnimationFrame(gameLoop);
    }

    // ìƒíƒœ ì—…ë°ì´íŠ¸
    function update() {
      const groundY = canvas.height - HAMSTER_SIZE - 50;
      if (keys['ArrowLeft']) hamster.x -= 4;
      if (keys['ArrowRight']) hamster.x += 4;
      hamster.vy += 0.5;
      hamster.y += hamster.vy;
      if (hamster.y >= groundY) { hamster.y=groundY; hamster.vy=0; hamster.onGround=true; }
      hamster.x = Math.max(0, Math.min(canvas.width-HAMSTER_SIZE, hamster.x));

      seeds = seeds.filter(s => {
        if (s.x < hamster.x+HAMSTER_SIZE && s.x+SEED_SIZE > hamster.x && s.y < hamster.y+HAMSTER_SIZE && s.y+SEED_SIZE > hamster.y) {
          score++; updateScoreboard(); return false;
        }
        return true;
      });

      obstacles.forEach(o => {
        if (hamster.x < o.x+o.width && hamster.x+HAMSTER_SIZE > o.x && hamster.y+HAMSTER_SIZE > o.y) {
          if (keys['ArrowRight']) hamster.x -=4;
          if (keys['ArrowLeft']) hamster.x +=4;
        }
      });

      if (score>=TARGET_SEEDS) endGame(true);
    }

    // ê·¸ë¦¬ê¸°
    function draw() {
      ctx.fillStyle='#555'; ctx.fillRect(0,0,canvas.width,canvas.height);
      ctx.fillStyle='#A0522D'; ctx.fillRect(0,canvas.height-50,canvas.width,50);
      ctx.fillStyle='#800000'; obstacles.forEach(o=>ctx.fillRect(o.x,o.y,o.width,o.height));
      ctx.fillStyle='#fff'; ctx.fillRect(hamster.x,hamster.y,HAMSTER_SIZE,HAMSTER_SIZE);
      ctx.fillStyle='#FFD700'; seeds.forEach(s=>ctx.fillRect(s.x,s.y,SEED_SIZE,SEED_SIZE));
    }

    // ì…ë ¥
    window.addEventListener('keydown', e => {
      if (e.code==='Space'&&hamster.onGround){e.preventDefault();hamster.vy=-12;hamster.onGround=false;}
      keys[e.key]=true;
    });
    window.addEventListener('keyup', e=>{keys[e.key]=false;});
  </script>
</body>
</html>
