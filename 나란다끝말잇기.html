<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë‚˜ë€ë‹¤ ëë§ì‡ê¸°</title>
  <style>
    /* ====== ê¸°ë³¸ ë¦¬ì…‹/ë ˆì´ì•„ì›ƒ ====== */
    :root{
      --bg:#0b0f17;
      --panel:#111827;
      --accent:#00e5ff;
      --accent2:#ff4d9d;
      --ok:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
      --muted:#9aa3b2;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:radial-gradient(1200px 600px at 50% -10%,#13203b 0%, var(--bg) 40%  );
      color:#e5e7eb; font-family: "Pretendard", "Apple SD Gothic Neo", system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Arial, sans-serif;
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .game{
      width:min(980px, 100%); background:linear-gradient(180deg, #0f172a 0%, #0b1223 60%, #0a0f1d 100%);
      border:1px solid #1f2937; border-radius:24px; box-shadow:0 20px 60px rgba(0,0,0,.5), inset 0 0 40px rgba(255,255,255,0.02);
      padding:20px 20px 24px; position:relative; overflow:hidden;
    }

    /* ====== ìƒë‹¨ ë„¤ì˜¨ ì ìˆ˜ ====== */
    .scorebar{
      text-align:center; font-weight:800; font-size: clamp(20px, 3.2vw, 36px);
      letter-spacing:1px; margin:4px 0 14px; position:relative;
      color:#e0faff;
      text-shadow: 0 0 7px rgba(0,229,255,.9), 0 0 18px rgba(0,229,255,.5), 0 0 48px rgba(0,229,255,.25);
    }
    .scorebar small{display:block; font-weight:600; opacity:.8; font-size: .55em; margin-top:6px; color:#aef7ff}

    /* ====== ìºë¦­í„° ì˜ì—­ ====== */
    .avatars{display:flex; justify-content:space-between; align-items:center; gap:16px; padding:8px 14px 4px}
    .avatar{display:flex; align-items:center; gap:12px}
    .emoji{
      font-size: clamp(42px, 7vw, 72px);
      filter: drop-shadow(0 4px 12px rgba(0,0,0,.5));
    }
    /* ë³‘ì•„ë¦¬(ì£¼ì¸ê³µ) ë‚ ê°œ íŒŒë‹¥íŒŒë‹¥ ëŠë‚Œì˜ ì‚´ì§ ë‘¥ì‹¤ë‘¥ì‹¤ ì• ë‹ˆë©”ì´ì…˜ */
    .emoji.chick{ animation: bob 1.1s ease-in-out infinite; transform-origin:50% 100%;}
    @keyframes bob{ 0%,100%{ transform: translateY(0) rotate(0deg);} 50%{ transform: translateY(-6px) rotate(-1deg);} }
    .name{font-weight:700; font-size:18px; color:#cbd5e1}

    /* ====== ì˜ì—­ êµ¬ë¶„ ====== */
    .row{display:grid; grid-template-columns:1.1fr .9fr; gap:18px; margin-top:12px}
    .panel{background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:14px; min-height:220px}
    .panel h3{margin:0 0 8px; font-size:16px; color:#b7c3d6; font-weight:700}

    /* ====== ë¡œê·¸ ====== */
    .log{height:260px; overflow:auto; background:rgba(0,0,0,.18); border-radius:12px; padding:10px; border:1px solid rgba(255,255,255,.06)}
    .entry{padding:8px 10px; border-radius:8px; margin:6px 0; line-height:1.4}
    .entry.you{background:rgba(34,197,94,.08); border:1px solid rgba(34,197,94,.25)}
    .entry.ai{background:rgba(0,229,255,.08); border:1px solid rgba(0,229,255,.25)}
    .tag{display:inline-block; padding:2px 8px; border-radius:999px; font-size:12px; margin-right:8px}
    .tag.you{background:rgba(34,197,94,.2); color:#9CF1B9}
    .tag.ai{background:rgba(0,229,255,.2); color:#aef7ff}

    /* ====== ì…ë ¥/ìƒíƒœ ====== */
    .need{font-size:18px; color:#a5b4fc; margin:10px 0 6px}
    .used{height:140px; overflow:auto; background:rgba(255,255,255,.03); border:1px dashed rgba(255,255,255,.08); border-radius:10px; padding:8px}
    .used b{color:#93c5fd}

    .inputbar{display:flex; gap:10px; margin-top:10px}
    input[type=text]{
      flex:1; background:#0b1223; border:1px solid #1f2a44; color:#e5e7eb; border-radius:12px; padding:14px 14px; font-size:16px;
      outline:none; box-shadow: inset 0 0 0 2px transparent; transition: .2s;
    }
    input[type=text]:focus{box-shadow: inset 0 0 0 2px var(--accent)}
    button{
      background: linear-gradient(180deg, #101c38 0%, #0a142a 100%);
      border:1px solid #1f2a44; color:#e6f6ff; border-radius:12px; padding:12px 16px; font-weight:700; cursor:pointer; transition:.15s;
    }
    button:hover{transform:translateY(-1px); box-shadow:0 6px 18px rgba(0,229,255,.15)}

    /* ì‹œì‘(í‚¹ì½©) ë²„íŠ¼ */
    .startwrap{display:flex; flex-direction:column; align-items:center; justify-content:center; gap:8px; padding:12px 0 4px}
    .startbtn{
      font-size:72px; line-height:1; background:transparent; border:none; filter: drop-shadow(0 6px 18px rgba(0,0,0,.5)); cursor:pointer;
      transition:.2s; border-radius:16px; padding:8px; user-select:none;
    }
    .startbtn:hover{ transform: scale(1.05) rotate(-2deg);}
    .startlabel{font-weight:700; color:#aef7ff}

    /* ====== ì¹´ìš´íŠ¸ë‹¤ìš´ ë°” ====== */
    .timerwrap{height:10px; background:#0f1a34; border:1px solid #1c2e57; border-radius:999px; overflow:hidden; margin-top:10px}
    .timerbar{height:100%; width:0%; background:linear-gradient(90deg, #2dd4bf, #22d3ee); transition: width .2s linear}
    .timertext{font-size:13px; color:#bcd5ff; text-align:right; margin-top:4px}

    /* ====== ìƒíƒœ í† ìŠ¤íŠ¸ ====== */
    .toast{position:absolute; left:50%; top:16px; transform:translateX(-50%); background:rgba(9, 29, 51, .8); border:1px solid rgba(0,229,255,.35); color:#e0faff; padding:10px 14px; border-radius:999px; font-weight:700; pointer-events:none; opacity:0; transition:.2s}
    .toast.show{opacity:1}

    /* ====== ìŠ¹ë¦¬/íŒ¨ë°° ëª¨ë‹¬ ====== */
    .modal{ position:fixed; inset:0; display:none; place-items:center; background:rgba(0,0,0,.6)}
    .modal.on{display:grid}
    .dialog{ background:#0b1223; border:1px solid #274069; border-radius:18px; padding:20px; width:min(520px, 92%); text-align:center }
    .dialog h2{margin:0 0 8px}
    .dialog p{margin:8px 0 14px; color:#cbd5e1}
    .dialog .actions{display:flex; gap:10px; justify-content:center}

    /* ë°˜ì‘í˜• */
    @media (max-width:820px){ .row{grid-template-columns:1fr} .log{height:220px} }
  </style>
</head>
<body>
  <div class="game" id="game">
    <!-- ìƒë‹¨ ë„¤ì˜¨ ì ìˆ˜íŒ -->
    <div class="scorebar" id="scorebar">ğŸ¥ 0  <span style="opacity:.7">vs</span>  0 ğŸ¦
      <small>ì£¼ì¸ê³µ vs ì  (ì ìˆ˜) â€” 30ì´ˆ ì•ˆì— ë‹µí•˜ì„¸ìš”!</small>
    </div>

    <!-- ìºë¦­í„° í‘œì‹œ -->
    <div class="avatars">
      <div class="avatar"><span class="emoji chick" aria-label="ì£¼ì¸ê³µ">ğŸ¥</span><span class="name">ì£¼ì¸ê³µ</span></div>
      <div class="avatar"><span class="name">ì  (ì»´í“¨í„°)</span><span class="emoji" aria-label="ì ">ğŸ¦</span></div>
    </div>

    <!-- ì‹œì‘ ë²„íŠ¼(í‚¹ì½© í´ë¦­) -->
    <div class="startwrap" id="startwrap">
      <button class="startbtn" id="startBtn" title="í‚¹ì½©ì„ í´ë¦­í•´ ì‹œì‘!">ğŸ¦</button>
      <div class="startlabel">í‚¹ì½©(ğŸ¦)ì„ í´ë¦­í•˜ë©´ ì‹œì‘</div>
    </div>

    <div class="row">
      <!-- ì¢Œ: ëŒ€í™” ë¡œê·¸ / íƒ€ì´ë¨¸ -->
      <div class="panel">
        <h3>ê²Œì„ ë¡œê·¸</h3>
        <div class="log" id="log" aria-live="polite"></div>
        <div class="timerwrap"><div class="timerbar" id="timerbar"></div></div>
        <div class="timertext" id="timertext">ë‚¨ì€ ì‹œê°„: 30.0ì´ˆ</div>
      </div>

      <!-- ìš°: ìƒíƒœ/ì…ë ¥ -->
      <div class="panel">
        <h3>ì…ë ¥ & ìƒíƒœ</h3>
        <div class="need" id="need">ì‹œì‘ì„ ëˆ„ë¥´ë©´ ì»´í“¨í„°ê°€ ì œì‹œì–´ë¥¼ ëƒ…ë‹ˆë‹¤.</div>
        <div class="used" id="used">ì‚¬ìš©ëœ ë‹¨ì–´: <b>(ì—†ìŒ)</b></div>
        <div class="inputbar">
          <input id="wordInput" type="text" placeholder="í•œê¸€ë¡œ ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" inputmode="text" disabled />
          <button id="submitBtn" disabled>ì…ë ¥</button>
        </div>
      </div>
    </div>

    <div class="toast" id="toast">ë©”ì‹œì§€</div>

    <!-- ìŠ¹íŒ¨ ëª¨ë‹¬ -->
    <div class="modal" id="modal">
      <div class="dialog">
        <h2 id="modalTitle">ê²Œì„ ì¢…ë£Œ</h2>
        <p id="modalDesc"></p>
        <div class="actions">
          <button id="restartBtn">ë‹¤ì‹œ ì‹œì‘</button>
        </div>
      </div>
    </div>
  </div>

<script>
/**
 * ë‚˜ë€ë‹¤ ëë§ì‡ê¸° â€” ìˆœìˆ˜ JS
 * ìš”êµ¬ì‚¬í•­ ë°˜ì˜:
 * - í‚¹ì½©(ğŸ¦) í´ë¦­ìœ¼ë¡œ ì‹œì‘
 * - 30ì´ˆ ì œí•œ, ì‹œê°„ ë‚´ ë¯¸ì…ë ¥ ì‹œ ê²Œì„ì˜¤ë²„
 * - 10ì´ˆ ë¯¸ë§Œ 20ì  / 20ì´ˆ ë¯¸ë§Œ 10ì  / 30ì´ˆ ì´í•˜ 5ì  (ì£¼ì¸ê³µ ì ìˆ˜)
 * - 20íšŒ ì •ë‹µ ì‹œ ìŠ¹ë¦¬
 * - ìƒë‹¨ ì¤‘ì•™ ë„¤ì˜¨ ìŠ¤íƒ€ì¼ ì ìˆ˜(ì£¼ì¸ê³µ vs ì )
 * - ì´ëª¨ì§€ í¬ê³  ì„ ëª…, ë³‘ì•„ë¦¬ ì‚´ì§ ì• ë‹ˆë©”ì´ì…˜
 */

// ê°„ë‹¨ í•œêµ­ì–´ ë‹¨ì–´ ëª©ë¡ (ëª…ì‚¬/ì´ë¦„/ì™¸ë˜ì–´ í¬í•¨, ì˜ˆì‹œ)
// ì‹¤ì œ ê²Œì„ì„± í–¥ìƒì„ ìœ„í•´ 200~500ì–´ ìˆ˜ì¤€ìœ¼ë¡œ í™•ì¥ ê°€ëŠ¥
const DICT = [
  "ì‚¬ê³¼","ê³¼ì","ìì „ê±°","ê±°ìš¸","ìš¸ìŒ","ìŒì•…","ì•…ê¸°","ê¸°ì°¨","ì°¨í‘œ","í‘œë²”","ë²”ê³ ë˜","ë˜í¼","í¼ì¦","ì¦ê±°ì›€","ì›€ë§‰","ë§‰ê±¸ë¦¬","ë¦¬ë³¸","ë³¸ëŠ¥","ëŠ¥ì„ ","ì„ ë¬¼","ë¬¼ê°","ê°ì","ìì„","ì„ë¥˜","ë¥˜í˜„ì§„","ì§„ì£¼","ì£¼ì°¨ì¥","ì¥ë¯¸","ë¯¸ë¡œ","ë¡œë´‡","ë´„ë¹„","ë¹„ëˆ„","ëˆ„ë‚˜","ë‚˜ë¬´","ë¬´ì§€ê°œ","ê°œë¯¸","ë¯¸ì—­","ì—­ì‚¬","ì‚¬ë‘","ë‘ë¹„","ë¹„í–‰ê¸°","ê¸°ëŸ¬ê¸°","ê¸°ë„","ë„ë„›","íŠ¸ëŸ­","ì»¤í”¼","í”¼ì•„ë…¸","ë…¸íŠ¸","íŠ¸ë¨","ë¨í”„","í”„ë¦°í„°","í„°ë„","ë„íŒì§€","ì§€êµ¬","êµ¬ë‘","ë‘ë¶€","ë¶€ì—Œ","ì—‘ìŠ¤ë ˆì´","ì´ë¶ˆ","ë¶ˆê½ƒ","ê½ƒë³‘","ë³‘ì•„ë¦¬","ë¦¬ì–´ì¹´","ì¹´ë©”ë¼","ë¼ë©´","ë©´ë„ê¸°","ê¸°ë¦„","ë¦„ë³´","ë³´ë¦¬","ë¦¬ë³¸","ë³¸ë“œ","ë“œëŸ¼","ëŸ¼ì£¼","ì£¼ë¨¸ë‹ˆ","ë‹ˆëª¨","ëª¨ì","ìì„","ì„íƒ„","íƒ„ì‚°","ì‚°ì†Œ","ì†Œë‚˜ë¬´","ë¬´ë‹¹ë²Œë ˆ","ë ˆëª¬","ëª¬ìŠ¤í„°","í„°ë¯¸ë„","ë„ë¹¤ì§€","ì§€ê°‘","ê°‘ì˜·","ì˜·ê±¸ì´","ì´ê¸€ë£¨","ë£¨í”„íƒ‘","íƒ‘ìŠ¹ê¶Œ","ê¶Œíˆ¬","íˆ¬ìˆ˜","ìˆ˜ë°•","ë°•ìˆ˜","ìˆ˜í•™","í•™ìš©í’ˆ","í’ˆì ˆ","ì ˆêµ¬","êµ¬ë¦„","ë¦„í”„","í”„ë¼ëª¨ë¸","ë¸ë¦¬ë§Œì¥¬","ì¥¬ìŠ¤","ìŠ¤ì¼€ì´íŠ¸","íŠ¸ë¨í„ë¦°","ë¦°ìŠ¤","ìŠ¤íƒ¬í”„","í”„ë¼ì´íŒ¬","íŒ¬í‹°","í‹°ì…”ì¸ ","ì¸ í‚¤","í‚¤ì˜¤ìŠ¤í¬","í¬ë ˆíŒŒìŠ¤","ìŠ¤ë…¸ìš°ë³¼","ë³¼íœ","íœì´‰","ì´‰ê°","ê°ê¸°","ê¸°ë„ë¬¸","ë¬¸ì–´","ì–´í•­","í•­ê³µê¸°","ê¸°ê´€ì°¨","ì°¨ëŒë°•ì´","ì´ì‚¿ì§","ì§ë³¼","ë³¼ë§","ë§ê±°","ê±°ë¯¸","ë¯¸ìˆ ","ìˆ ì”","ì”ë””","ë””ë”¤ëŒ","ëŒê³ ë˜","ë˜ë¯¸ì•ˆ","ì•ˆê²½","ê²½ë³µê¶","ê¶ì „","ì „ìë ˆì¸ì§€","ì§€ë…¸","ë…¸ë˜","ë ˆì½”ë“œ","ë“œë¼ì´ë²„","ë²„ìŠ¤","ìŠ¤í‚¤","í‚¤ìœ„","ìœ„ì„±","ì„±ëƒ¥","ëƒ¥ì´","ì´ì–´í°","í°ì¼€ì´ìŠ¤","ìŠ¤í”„ë§","ë§ì½˜","ì½˜ì„œíŠ¸","íŠ¸ë¡œí”¼","í”¼êµ¬","êµ¬ìŠ¬","ìŠ¬ë¦¬í¼","í¼í¬ë¨¼ìŠ¤","ìŠ¤íŠœë””ì˜¤","ì˜¤ë Œì§€","ì§€ë ì´","ì´ì•¼ê¸°","ê¸°ë„ë¬¸","ë¬¸ì‹ ","ì‹ ë°œ","ë°œë ˆ","ë ˆëª¬ì—ì´ë“œ","ë“œë¡ ","ë¡ ë„","ë„ì‹œ","ì‹œê³„","ê³„ë‹¨","ë‹¨í’","í’ì„ ","ì„ í’ê¸°","ê¸°ì™“ì¥","ì¥ê°‘","ê°‘íŒ","íŒë‹¤","ë‹¤ëŒì¥","ì¥ë«","ë«ì§ˆ","ì§ˆì†Œ","ì†ŒíŒŒ","íŒŒì „","ì „í™”","í™”ë¶„","ë¶„ìˆ˜","ìˆ˜ë©´","ë©´ë´‰","ë´‰íˆ¬","íˆ¬ëª…","ëª…í•¨","í•¨ì •","ì •ë‹µ"
];

// ìœ í‹¸: í•œê¸€ë§Œ í—ˆìš© (ê°€-í£, ë„ì–´ì“°ê¸°/í•˜ì´í”ˆ ì œê±°)
function sanitize(word){
  return word.replace(/\s|-/g,"").replace(/[^ê°€-í£]/g,"");
}

function lastChar(word){ return word[word.length-1]; }
function firstChar(word){ return word[0]; }

// ìƒíƒœ
let used = new Set();
let playerScore = 0;
let aiScore = 0; // ê°„ë‹¨íˆ: ì»´í“¨í„°ê°€ ë‹¨ì–´ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë‚´ë©´ +10ì 
let playerAnswers = 0; // í”Œë ˆì´ì–´ê°€ ë§ì¶˜ íšŸìˆ˜
let expectedFirst = null; // ë‹¤ìŒ ë‹¨ì–´ì˜ ì²« ê¸€ì
let timerId = null;
let startTs = 0;
let alive = false;

// ì—˜ë¦¬ë¨¼íŠ¸ ì°¸ì¡°
const $log = document.getElementById('log');
const $used = document.getElementById('used');
const $need = document.getElementById('need');
const $scorebar = document.getElementById('scorebar');
const $timerbar = document.getElementById('timerbar');
const $timertext = document.getElementById('timertext');
const $input = document.getElementById('wordInput');
const $submit = document.getElementById('submitBtn');
const $start = document.getElementById('startBtn');
const $startwrap = document.getElementById('startwrap');
const $toast = document.getElementById('toast');
const $modal = document.getElementById('modal');
const $modalTitle = document.getElementById('modalTitle');
const $modalDesc = document.getElementById('modalDesc');
const $restart = document.getElementById('restartBtn');

function toast(msg){
  $toast.textContent = msg; $toast.classList.add('show');
  setTimeout(()=> $toast.classList.remove('show'), 1000);
}

function logEntry(type, text){
  const div = document.createElement('div');
  div.className = 'entry ' + (type==='you'?'you':'ai');
  const tag = `<span class="tag ${type==='you'?'you':'ai'}">${type==='you'?'ğŸ¥ ì£¼ì¸ê³µ':'ğŸ¦ ì '}</span>`;
  div.innerHTML = `${tag}${text}`;
  $log.appendChild(div);
  $log.scrollTop = $log.scrollHeight;
}

function updateUsed(){
  if(!used.size){ $used.innerHTML = 'ì‚¬ìš©ëœ ë‹¨ì–´: <b>(ì—†ìŒ)</b>'; return; }
  $used.innerHTML = 'ì‚¬ìš©ëœ ë‹¨ì–´: ' + Array.from(used).map(w=>`<b>${w}</b>`).join(', ');
}

function updateScore(){
  $scorebar.innerHTML = `ğŸ¥ ${playerScore} <span style="opacity:.7">vs</span> ${aiScore} ğŸ¦<small>ì£¼ì¸ê³µ vs ì  (ì ìˆ˜) â€” ${playerAnswers}/20 íšŒ ì§„í–‰</small>`;
}

function setExpectedNext(char){
  expectedFirst = char;
  $need.innerHTML = `ë‹¤ìŒ ë‹¨ì–´ì˜ ì²« ê¸€ì: <b style="color:#60a5fa">${char ?? 'ììœ '}</b>`;
}

function enableInput(on){
  $input.disabled = !on; $submit.disabled = !on; if(on){ $input.focus(); }
}

// íƒ€ì´ë¨¸ ì œì–´ (30ì´ˆ)
function startTimer(){
  stopTimer();
  const limit = 30.0; // seconds
  startTs = performance.now();
  $timerbar.style.width = '0%';
  $timertext.textContent = `ë‚¨ì€ ì‹œê°„: ${limit.toFixed(1)}ì´ˆ`;
  timerId = requestAnimationFrame(function tick(){
    const elapsed = (performance.now() - startTs)/1000;
    const remain = Math.max(0, limit - elapsed);
    const ratio = Math.min(1, elapsed/limit);
    $timerbar.style.width = `${ratio*100}%`;
    $timertext.textContent = `ë‚¨ì€ ì‹œê°„: ${remain.toFixed(1)}ì´ˆ`;
    if(remain <= 0){
      // ì‹œê°„ì´ˆê³¼ â†’ ê²Œì„ì˜¤ë²„
      stopTimer();
      gameOver('ì‹œê°„ ì´ˆê³¼! 30ì´ˆ ì•ˆì— ë‹µì„ ì…ë ¥í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
      return;
    }
    timerId = requestAnimationFrame(tick);
  });
}
function stopTimer(){ if(timerId){ cancelAnimationFrame(timerId); timerId = null; } }

// ì ìˆ˜ ê³„ì‚° (ì‘ë‹µ ì‹œê°„ ê¸°ë°˜)
function scoreFromResponseSec(sec){
  if(sec < 10) return 20;
  if(sec < 20) return 10;
  return 5; // 30ì´ˆ ì´í•˜
}

// ë‹¨ì–´ ìœ íš¨ì„± ì²´í¬
function isValidNewWord(userWord){
  if(!userWord) return {ok:false, msg:'ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'};
  if(!/^[ê°€-í£]+$/.test(userWord)) return {ok:false, msg:'í•œê¸€ë§Œ ì…ë ¥ ê°€ëŠ¥í•´ìš”.'};
  if(userWord.length < 2) return {ok:false, msg:'2ê¸€ì ì´ìƒ ë‹¨ì–´ë§Œ í—ˆìš©í•´ìš”.'};
  if(used.has(userWord)) return {ok:false, msg:'ì´ë¯¸ ì‚¬ìš©ëœ ë‹¨ì–´ì˜ˆìš”.'};
  if(expectedFirst && firstChar(userWord) !== expectedFirst) return {ok:false, msg:`'${expectedFirst}'(ìœ¼)ë¡œ ì‹œì‘í•´ì•¼ í•´ìš”.`};
  return {ok:true};
}

// ì»´í“¨í„°ê°€ ë‚¼ ë‹¨ì–´ ì°¾ê¸°
function aiPick(nextFirst){
  const candidates = DICT.filter(w => firstChar(w) === nextFirst && !used.has(w));
  if(candidates.length === 0) return null;
  // ê°„ë‹¨ ëœë¤
  return candidates[Math.floor(Math.random()*candidates.length)];
}

function aiTurn(prevWord){
  const need = lastChar(prevWord);
  const pick = aiPick(need);
  if(!pick){
    logEntry('ai', `ë‹¨ì–´ë¥¼ ì°¾ì§€ ëª»í–ˆì–´ìš”â€¦ ì£¼ì¸ê³µì˜ ìŠ¹ë¦¬! ğŸ†`);
    return gameWin('ì»´í“¨í„°ê°€ ì´ì–´ê°ˆ ë‹¨ì–´ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. ì¶•í•˜í•©ë‹ˆë‹¤!');
  }
  used.add(pick);
  aiScore += 10; // ê°„ë‹¨í•œ ì  ì ìˆ˜ ê·œì¹™
  updateScore();
  logEntry('ai', `"${pick}"`);
  setExpectedNext(lastChar(pick));
  startTimer();
  enableInput(true);
}

function onSubmit(){
  if(!alive) return;
  const raw = $input.value.trim();
  const word = sanitize(raw);
  const check = isValidNewWord(word);
  if(!check.ok){ toast(check.msg); return; }
  // ì •ë‹µ!
  stopTimer();
  const elapsed = (performance.now() - startTs)/1000;
  const gained = scoreFromResponseSec(elapsed);
  playerScore += gained;
  playerAnswers += 1;
  updateScore();
  used.add(word);
  logEntry('you', `"${word}"  <small style="color:#9ad6ff">(+${gained}ì  / ${elapsed.toFixed(1)}ì´ˆ)</small>`);
  $input.value = '';
  updateUsed();

  // 20íšŒ ë‹¬ì„± ì‹œ ìŠ¹ë¦¬
  if(playerAnswers >= 20){
    return gameWin('ëª©í‘œ 20íšŒ ë‹¬ì„±! ë©‹ì ¸ìš”!');
  }

  // ë‹¤ìŒ: ì»´í“¨í„° ì°¨ë¡€
  enableInput(false);
  setTimeout(()=> aiTurn(word), 450); // ì•½ê°„ì˜ í…€ìœ¼ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ
}

function gameWin(msg){
  alive = false; enableInput(false); stopTimer();
  $modalTitle.textContent = 'ìŠ¹ë¦¬! ğŸ†';
  $modalDesc.innerHTML = `${msg}<br><br><b>ìµœì¢… ì ìˆ˜</b> â€” ğŸ¥ ${playerScore} : ${aiScore} ğŸ¦`;
  $modal.classList.add('on');
}

function gameOver(msg){
  alive = false; enableInput(false); stopTimer();
  $modalTitle.textContent = 'ê²Œì„ ì˜¤ë²„ ğŸ’¥';
  $modalDesc.innerHTML = `${msg}<br><br><b>ìµœì¢… ì ìˆ˜</b> â€” ğŸ¥ ${playerScore} : ${aiScore} ğŸ¦`;
  $modal.classList.add('on');
}

function reset(){
  used.clear(); playerScore=0; aiScore=0; playerAnswers=0; expectedFirst=null; alive=false;
  updateScore(); updateUsed(); setExpectedNext(null);
  $log.innerHTML = '';
  $startwrap.style.display = '';
  enableInput(false);
  stopTimer();
  $timerbar.style.width = '0%';
  $timertext.textContent = 'ë‚¨ì€ ì‹œê°„: 30.0ì´ˆ';
}

function start(){
  reset();
  alive = true;
  $startwrap.style.display = 'none';

  // ì»´í“¨í„°ê°€ ì‹œì‘ ì œì‹œì–´ë¥¼ ëƒ„
  const startWord = DICT[Math.floor(Math.random()*DICT.length)];
  used.add(startWord);
  logEntry('ai', `ì‹œì‘ ì œì‹œì–´ëŠ” "${startWord}" ì…ë‹ˆë‹¤.`);
  updateUsed();
  setExpectedNext(lastChar(startWord));
  enableInput(true);
  startTimer();
}

// ì´ë²¤íŠ¸ ë°”ì¸ë”©
$submit.addEventListener('click', onSubmit);
$input.addEventListener('keydown', (e)=>{ if(e.key==='Enter') onSubmit(); });
$start.addEventListener('click', start);
$restart.addEventListener('click', ()=>{ $modal.classList.remove('on'); start(); });

// ì´ˆê¸°í™”
reset();
</script>
</body>
</html>
