<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>RIVAL Shooter</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: #111;
  }
  canvas {
    display: block;
    margin: 0 auto;
    background: #333;
  }
  #scoreBoard {
    position: absolute;
    top: 10px;
    left: 10px;
    color: white;
    font-size: 20px;
    font-family: Arial, sans-serif;
  }
  #controls {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  button {
    padding: 10px 20px;
    font-size: 20px;
    cursor: pointer;
    border: none;
    border-radius: 5px;
  }
</style>
</head>
<body>
  <div id="scoreBoard">점수: 0 | HP: 5</div>
  <div id="controls">
    <button id="startBtn">게임 시작</button>
    <button id="restartBtn" style="display:none;">다시 시작</button>
  </div>
  <canvas id="gameCanvas" width="800" height="600"></canvas>
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const startBtn = document.getElementById('startBtn');
    const restartBtn = document.getElementById('restartBtn');
    const controls = document.getElementById('controls');

    let keys = {};
    let score = 0;
    let bullets = [];
    let enemies = [];
    let gameRunning = false;

    // 플레이어 설정 (HP 5)
    const player = {
      x: 400,
      y: 300,
      size: 20,
      speed: 4,
      alive: true,
      hp: 5
    };

    // 총알 클래스 (플레이어만 사용)
    class Bullet {
      constructor(x, y, dx, dy) {
        this.x = x;
        this.y = y;
        this.dx = dx;
        this.dy = dy;
        this.size = 5;
      }
      update() {
        this.x += this.dx;
        this.y += this.dy;
      }
      draw() {
        ctx.fillStyle = 'yellow';
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    // 적 클래스 (왼쪽에서 오른쪽으로 이동, 사람 모양)
    class Enemy {
      constructor(y) {
        this.x = 0; // 항상 왼쪽에서 시작
        this.y = y;
        this.size = 20;
        this.hp = 100;
        this.speed = 2;
      }
      update() {
        this.x += this.speed; // 오른쪽으로 이동
      }
      draw() {
        ctx.fillStyle = 'red';
        // 머리
        ctx.beginPath();
        ctx.arc(this.x, this.y - this.size, this.size/2, 0, Math.PI * 2);
        ctx.fill();
        // 몸통
        ctx.fillRect(this.x - this.size/4, this.y - this.size/2, this.size/2, this.size);
        // 팔
        ctx.fillRect(this.x - this.size/1.2, this.y - this.size/2, this.size, 5);
        // 다리
        ctx.fillRect(this.x - this.size/4, this.y + this.size/2, 5, this.size/1.2);
        ctx.fillRect(this.x + this.size/8, this.y + this.size/2, 5, this.size/1.2);
      }
    }

    // 키 입력 (방향키 & W키 총알 발사)
    document.addEventListener('keydown', e => {
      keys[e.key] = true;
      if ((e.key === 'w' || e.key === 'W') && player.alive && gameRunning) {
        bullets.push(new Bullet(player.x, player.y, -6, 0));
      }
    });
    document.addEventListener('keyup', e => keys[e.key] = false);

    // 게임 루프
    function gameLoop() {
      if (!gameRunning) return;

      if (!player.alive) {
        ctx.fillStyle = 'white';
        ctx.font = '40px Arial';
        ctx.fillText('게임 오버!', 320, 300);
        restartBtn.style.display = 'block';
        return;
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (keys['ArrowUp']) player.y -= player.speed;
      if (keys['ArrowDown']) player.y += player.speed;
      if (keys['ArrowLeft']) player.x -= player.speed;
      if (keys['ArrowRight']) player.x += player.speed;

      // 플레이어 그리기 (사람 모양, 녹색 + 총)
      ctx.fillStyle = 'lime';
      // 머리
      ctx.beginPath();
      ctx.arc(player.x, player.y - player.size, player.size/2, 0, Math.PI * 2);
      ctx.fill();
      // 몸통
      ctx.fillRect(player.x - player.size/4, player.y - player.size/2, player.size/2, player.size);
      // 팔 (총 포함)
      ctx.fillRect(player.x - player.size/1.2, player.y - player.size/2, player.size, 5);
      ctx.fillStyle = 'gray';
      ctx.fillRect(player.x - player.size/1.2 - 10, player.y - player.size/2, 15, 5); // 총
      ctx.fillStyle = 'lime';
      // 다리
      ctx.fillRect(player.x - player.size/4, player.y + player.size/2, 5, player.size/1.2);
      ctx.fillRect(player.x + player.size/8, player.y + player.size/2, 5, player.size/1.2);

      bullets.forEach((b, i) => {
        b.update();
        b.draw();
        if (b.x < 0 || b.x > canvas.width || b.y < 0 || b.y > canvas.height) {
          bullets.splice(i, 1);
        }
      });

      enemies.forEach((enemy, i) => {
        enemy.update();
        enemy.draw();

        if (enemy.x > canvas.width) {
          enemies.splice(i, 1); // 화면 밖으로 나가면 제거
        }

        const dx = enemy.x - player.x;
        const dy = enemy.y - player.y;
        const dist = Math.sqrt(dx*dx + dy*dy);
        if (dist < enemy.size + player.size) {
          player.hp -= 1;
          if (player.hp <= 0) {
            player.alive = false;
          }
          document.getElementById('scoreBoard').innerText = '점수: ' + score + ' | HP: ' + player.hp;
          enemies.splice(i, 1);
        }

        bullets.forEach((b, bi) => {
          const dx = enemy.x - b.x;
          const dy = enemy.y - b.y;
          const dist = Math.sqrt(dx*dx + dy*dy);
          if (dist < enemy.size + b.size) {
            enemy.hp -= 50;
            bullets.splice(bi, 1);
            if (enemy.hp <= 0) {
              enemies.splice(i, 1);
              score += 100;
              document.getElementById('scoreBoard').innerText = '점수: ' + score + ' | HP: ' + player.hp;
            }
          }
        });
      });

      requestAnimationFrame(gameLoop);
    }

    function spawnEnemy() {
      if (!gameRunning) return;
      const y = Math.random() * canvas.height;
      enemies.push(new Enemy(y));
      setTimeout(spawnEnemy, 3000);
    }

    startBtn.addEventListener('click', () => {
      controls.style.display = 'none';
      resetGame();
      gameRunning = true;
      spawnEnemy();
      gameLoop();
    });

    restartBtn.addEventListener('click', () => {
      resetGame();
      restartBtn.style.display = 'none';
      gameRunning = true;
      spawnEnemy();
      gameLoop();
    });

    function resetGame() {
      score = 0;
      bullets = [];
      enemies = [];
      player.x = 400;
      player.y = 300;
      player.alive = true;
      player.hp = 5;
      document.getElementById('scoreBoard').innerText = '점수: 0 | HP: 5';
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }
  </script>
</body>
</html>
