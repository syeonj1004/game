<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì „ì„¤ì˜ ëª¨í—˜</title>
  <style>
    body {
      margin: 0;
      background: linear-gradient(to bottom, #001f3f, #0074D9, #7FDBFF);
      color: white;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      overflow: hidden;
    }
    canvas {
      background: rgba(0,0,0,0.4);
      display: block;
      margin: 20px auto;
      border: 3px solid #fff;
      border-radius: 10px;
      box-shadow: 0 0 20px rgba(255,255,255,0.6);
    }
    #info {
      font-family: monospace;
      margin-top: 10px;
      background: rgba(0,0,0,0.5);
      padding: 5px 15px;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <h1>ì „ì„¤ì˜ ëª¨í—˜</h1>
  <canvas id="gameCanvas" width="500" height="400"></canvas>
  <div id="info">ë ˆë²¨: 1 | ì ìˆ˜: 0 | ì²´ë ¥: 3</div>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // ì£¼ì¸ê³µ
    const player = { x: 220, y: 330, w: 60, h: 60, speed: 5, hp: 3, dx:0, dy:0, emoji: "ğŸ§", canAttack: false, hasLightSword: false };

    // ì ê³¼ ì•„ì´í…œ
    let monsters = [];
    let dragonOrbs = []; // ìš© ì£¼ë³€ì— ìƒì„±ë˜ëŠ” êµ¬ìŠ¬
    let swords = [];
    let powerItems = [];
    let healItems = [];
    let lightSwords = [];
    let bosses = [];

    // ê²Œì„ ìƒíƒœ
    let score = 0;
    let level = 1;
    let gameOver = false;

    // í‚¤ ì…ë ¥
    document.addEventListener("keydown", e => {
      if (e.key === "ArrowLeft") player.dx = -player.speed;
      if (e.key === "ArrowRight") player.dx = player.speed;
      if (e.key === "ArrowUp") player.dy = -player.speed;
      if (e.key === "ArrowDown") player.dy = player.speed;
    });

    document.addEventListener("keyup", e => {
      if (e.key === "ArrowLeft" || e.key === "ArrowRight") player.dx = 0;
      if (e.key === "ArrowUp" || e.key === "ArrowDown") player.dy = 0;
    });

    // ì  ìƒì„±
    function spawnMonster(strong = false) {
      if (strong) {
        let dragon = { x: Math.random()*400, y: -100, w: 100, h: 100, hp: level*5, emoji: "ğŸ‰", isDragon: true };
        monsters.push(dragon);
        let orbInterval = setInterval(() => {
          if (monsters.includes(dragon) && !gameOver) {
            dragonOrbs.push({ parent: dragon, angle: 0, radius: 40, emoji: "ğŸ”µ" });
          } else {
            clearInterval(orbInterval);
          }
        }, 2000);
      } else {
        monsters.push({ x: Math.random()*460, y: -30, w: 40, h: 40, hp: level, emoji: "ğŸ‘¾", isDragon: false });
      }
    }

    // ë³´ìŠ¤ ìƒì„± (ë ˆë²¨5ë§ˆë‹¤)
    function spawnBoss() {
      let boss = { x: 150, y: -150, w: 200, h: 200, hp: level*20, emoji: "ğŸ‘¹", isBoss: true };
      bosses.push(boss);
      alert("ğŸ‘¹ ê±°ëŒ€í•œ ë³´ìŠ¤ ë“±ì¥! ì¤€ë¹„í•˜ì„¸ìš”!");
    }

    // ì•„ì´í…œ ìƒì„±
    function spawnSword() { swords.push({ x: Math.random()*460, y: -30, w: 20, h: 20, emoji: "âš”ï¸" }); }
    function spawnPowerItem() { powerItems.push({ x: Math.random()*460, y: -30, w: 25, h: 25, emoji: "âš¡" }); }
    function spawnHealItem() { healItems.push({ x: Math.random()*460, y: -30, w: 25, h: 25, emoji: "â¤ï¸" }); }
    function spawnLightSword() { lightSwords.push({ x: Math.random()*460, y: -30, w: 30, h: 30, emoji: "ğŸ”†" }); }

    // ì¶©ëŒ í™•ì¸
    function isColliding(a, b) {
      return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
    }

    // ë ˆë²¨ ìë™ ì¦ê°€
    setInterval(() => {
      if (!gameOver) {
        level++;
        alert("30ì´ˆ ê²½ê³¼! ë‹¤ìŒ ë ˆë²¨ë¡œ ì§„ì…! í˜„ì¬ ë ˆë²¨: "+level);
        if (level % 5 === 0) {
          spawnBoss();
        }
      }
    }, 30000);

    // 20ì´ˆë§ˆë‹¤ ê°•í•œ ì  ìƒì„±
    setInterval(() => {
      if (!gameOver) {
        spawnMonster(true);
        alert("ê°•ë ¥í•œ ìš©ì´ ë‚˜íƒ€ë‚¬ë‹¤! ì¡°ì‹¬í•˜ì„¸ìš”!");
      }
    }, 20000);

    // ê²Œì„ ë£¨í”„
    function gameLoop() {
      if (gameOver) return;

      ctx.clearRect(0,0,500,400);

      // ì£¼ì¸ê³µ ì´ë™
      player.x += player.dx;
      player.y += player.dy;
      if (player.x < 0) player.x = 0;
      if (player.x > 440) player.x = 440;
      if (player.y < 0) player.y = 0;
      if (player.y > 340) player.y = 340;

      // ì£¼ì¸ê³µ ê·¸ë¦¬ê¸°
      ctx.font = "50px Arial";
      ctx.fillText(player.emoji, player.x, player.y + player.h);

      // ë³´ìŠ¤ ì´ë™ ë° ì¶©ëŒ
      ctx.font = "80px Arial";
      for (let i=bosses.length-1; i>=0; i--) {
        let b = bosses[i];
        b.y += 1;
        ctx.fillText(b.emoji, b.x, b.y + b.h);
        if (isColliding(player, b)) {
          if (player.hasLightSword || player.canAttack) {
            bosses.splice(i,1);
            score += 1000;
            alert("ë³´ìŠ¤ë¥¼ ë¬¼ë¦¬ì³¤ë‹¤!");
          } else {
            player.hp -= 3;
            if (player.hp <= 0) {
              gameOver = true;
              alert("ê²Œì„ ì˜¤ë²„! ì ìˆ˜: "+score);
            }
          }
        } else if (b.y > 400) {
          bosses.splice(i,1);
        }
      }

      // ëª¬ìŠ¤í„° ì´ë™ ë° ì¶©ëŒ
      ctx.font = "50px Arial";
      for (let i=monsters.length-1; i>=0; i--) {
        let m = monsters[i];
        m.y += 1.5;
        ctx.fillText(m.emoji, m.x, m.y + m.h);
        if (isColliding(player, m)) {
          if (player.hasLightSword || player.canAttack) {
            monsters.splice(i,1);
            score += player.hasLightSword ? 500 : 200;
          } else {
            player.hp -= 1;
            monsters.splice(i,1);
            if (player.hp <= 0) {
              gameOver = true;
              alert("ê²Œì„ ì˜¤ë²„! ì ìˆ˜: "+score);
            }
          }
        } else if (m.y > 400) {
          monsters.splice(i,1);
        }
      }

      // ìš©ì˜¥ ì´ë™ ë° ì¶©ëŒ
      ctx.font = "20px Arial";
      for (let i=dragonOrbs.length-1; i>=0; i--) {
        let orb = dragonOrbs[i];
        if (!monsters.includes(orb.parent)) {
          dragonOrbs.splice(i,1);
          continue;
        }
        orb.angle += 0.1;
        orb.x = orb.parent.x + orb.parent.w/2 + Math.cos(orb.angle) * orb.radius;
        orb.y = orb.parent.y + orb.parent.h/2 + Math.sin(orb.angle) * orb.radius;
        ctx.fillText(orb.emoji, orb.x, orb.y);
        if (isColliding(player, {x:orb.x, y:orb.y, w:20, h:20})) {
          if (!player.hasLightSword && !player.canAttack) {
            player.hp -= 1;
            dragonOrbs.splice(i,1);
            if (player.hp <= 0) {
              gameOver = true;
              alert("ê²Œì„ ì˜¤ë²„! ì ìˆ˜: "+score);
            }
          } else {
            dragonOrbs.splice(i,1);
            score += 300;
          }
        }
      }

      // ê²€ ì•„ì´í…œ ì¶©ëŒ
      ctx.font = "24px Arial";
      for (let i=swords.length-1; i>=0; i--) {
        let s = swords[i];
        s.y += 2;
        ctx.fillText(s.emoji, s.x, s.y + s.h);
        if (isColliding(player, s)) {
          score += 100;
          swords.splice(i,1);
          if (score % 500 === 0) {
            level++;
            alert("ë ˆë²¨ ì—…! í˜„ì¬ ë ˆë²¨: "+level);
            if (level % 5 === 0) spawnBoss();
          }
        } else if (s.y > 400) {
          swords.splice(i,1);
        }
      }

      // ê³µê²© ì•„ì´í…œ ì¶©ëŒ
      ctx.font = "26px Arial";
      for (let i=powerItems.length-1; i>=0; i--) {
        let p = powerItems[i];
        p.y += 2;
        ctx.fillText(p.emoji, p.x, p.y + p.h);
        if (isColliding(player, p)) {
          powerItems.splice(i,1);
          player.canAttack = true;
          alert("âš¡ ê³µê²© ì•„ì´í…œ íšë“! 5ì´ˆ ë™ì•ˆ ì ì„ ì²˜ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!");
          setTimeout(() => { player.canAttack = false; }, 5000);
        } else if (p.y > 400) {
          powerItems.splice(i,1);
        }
      }

      // ì²´ë ¥ íšŒë³µ ì•„ì´í…œ ì¶©ëŒ
      ctx.font = "26px Arial";
      for (let i=healItems.length-1; i>=0; i--) {
        let h = healItems[i];
        h.y += 2;
        ctx.fillText(h.emoji, h.x, h.y + h.h);
        if (isColliding(player, h)) {
          healItems.splice(i,1);
          player.hp += 1;
          alert("â¤ï¸ ì²´ë ¥ íšŒë³µ! í˜„ì¬ ì²´ë ¥: "+player.hp);
        } else if (h.y > 400) {
          healItems.splice(i,1);
        }
      }

      // ë¹›ì˜ ê²€ ì•„ì´í…œ ì¶©ëŒ
      ctx.font = "28px Arial";
      for (let i=lightSwords.length-1; i>=0; i--) {
        let l = lightSwords[i];
        l.y += 2;
        ctx.fillText(l.emoji, l.x, l.y + l.h);
        if (isColliding(player, l)) {
          lightSwords.splice(i,1);
          player.hasLightSword = true;
          alert("ğŸ”† ë¹›ì˜ ê²€ íšë“! ëª¨ë“  ì ì„ ì‰½ê²Œ ì²˜ì¹˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!");
          setTimeout(() => { player.hasLightSword = false; }, 10000);
        } else if (l.y > 400) {
          lightSwords.splice(i,1);
        }
      }

      // HUD ì—…ë°ì´íŠ¸
      let status = `ë ˆë²¨: ${level} | ì ìˆ˜: ${score} | ì²´ë ¥: ${player.hp}`;
      if (player.hasLightSword) status += " | ë¹›ì˜ ê²€ ë°œë™!";
      else if (player.canAttack) status += " | ê³µê²© ê°€ëŠ¥!";
      document.getElementById("info").textContent = status;

      requestAnimationFrame(gameLoop);
    }

    // ìƒì„± íƒ€ì´ë¨¸
    setInterval(spawnMonster, 2000);
    setInterval(spawnSword, 3000);
    setInterval(spawnPowerItem, 10000);
    setInterval(spawnHealItem, 15000);
    setInterval(spawnLightSword, 20000);

    gameLoop();
  </script>
</body>
</html>
