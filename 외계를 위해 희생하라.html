<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì™¸ê³„ë¥¼ ìœ„í•´ í¬ìƒí•˜ë¼</title>
  <!-- í”½ì…€ ëŠë‚Œ í°íŠ¸ -->
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    /* â€”â€” ì „ì—­ ìŠ¤íƒ€ì¼ â€”â€” */
    :root{
      --ui-bg:#0b0f1a;      /* UI íŒ¨ë„ ë°°ê²½ */
      --ui-fg:#e7f2ff;      /* UI ê¸€ì */
      --ui-ac:#5bd5ff;      /* ê°•ì¡° ìƒ‰ */
      --btn:#131b2b;        /* ë²„íŠ¼ ë°°ê²½ */
      --btn-h:#1a2540;      /* ë²„íŠ¼ hover */
      --danger:#ff4d6d;     /* í­íƒ„/í­ë°œ */
      --win:#70ff8a;        /* ìŠ¹ë¦¬ ìƒ‰ */
      --lose:#ffd166;       /* ì¢…ë£Œ ìƒ‰ */
    }
    html,body{height:100%;}
    body{
      margin:0;
      background:#000; /* ìº”ë²„ìŠ¤ ì™¸ë¶€ ë°°ê²½ */
      color:var(--ui-fg);
      font-family:"Press Start 2P", system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      display:flex; align-items:center; justify-content:center;
    }
    .wrap{position:relative; width:960px; max-width:96vw;}
    canvas{
      width:100%; height:auto; image-rendering: pixelated; /* í”½ì…€ ì•„íŠ¸ ëŠë‚Œ */
      background:#000; display:block; border:2px solid #222; border-radius:12px; box-shadow:0 10px 40px rgba(0,0,0,.6);
    }

    /* â€”â€” HUD â€”â€” */
    .hud{
      position:absolute; inset:0; pointer-events:none; /* í´ë¦­ì€ ë°‘ì˜ ìº”ë²„ìŠ¤ë¡œ */
      display:flex; flex-direction:column; justify-content:space-between;
      padding:12px; box-sizing:border-box;
    }
    .row{display:flex; gap:10px; align-items:center;}
    .panel{
      pointer-events:auto; /* ë²„íŠ¼ í´ë¦­ ê°€ëŠ¥í•˜ê²Œ */
      background:linear-gradient(180deg, rgba(11,15,26,.9), rgba(11,15,26,.6));
      border:1px solid #223; border-radius:10px; padding:10px 12px; backdrop-filter: blur(4px);
      box-shadow: inset 0 0 0 1px rgba(255,255,255,.04), 0 8px 20px rgba(0,0,0,.35);
    }
    .stats{display:flex; gap:14px; align-items:center; font-size:12px;}
    .label{opacity:.8; margin-right:6px;}
    .pill{
      padding:6px 10px; border-radius:999px; background:#0d1426; border:1px solid #223; font-size:12px;
    }
    .bomb-pill{border-color:var(--danger); box-shadow:0 0 0 2px rgba(255,77,109,.15) inset;}

    /* â€”â€” ë²„íŠ¼ â€”â€” */
    .buttons{display:flex; gap:10px;}
    button{
      pointer-events:auto; cursor:pointer; user-select:none;
      background:var(--btn); color:var(--ui-fg); border:1px solid #2d3756; border-radius:10px;
      padding:10px 14px; font-family:inherit; font-size:12px; letter-spacing:.5px; text-transform:uppercase;
      box-shadow:0 6px 16px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.04);
      transition: transform .06s ease, background .2s ease;
    }
    button:hover{ background:var(--btn-h); }
    button:active{ transform: translateY(1px) scale(.99); }

    /* â€”â€” ì˜¤ë²„ë ˆì´ (ì‹œì‘/ìŠ¹ë¦¬/íŒ¨ë°°) â€”â€” */
    .overlay{
      position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center;
      gap:18px; background: radial-gradient(60% 60% at 50% 40%, rgba(35,50,90,.25), rgba(0,0,0,.65));
      text-align:center; backdrop-filter: blur(2px);
    }
    .title{font-size:20px; color:var(--ui-ac); text-shadow:0 2px 0 #000, 0 0 20px rgba(91,213,255,.25);}
    .subtitle{font-size:12px; opacity:.9;}
    .big{font-size:14px;}
    .win{ color: var(--win); }
    .lose{ color: var(--lose); }
    .kbd{ background:#111a2b; border:1px solid #2d3756; padding:4px 6px; border-radius:6px; font-size:11px; }
  </style>
</head>
<body>
  <div class="wrap">
    <!-- ì‹¤ì œ ê²Œì„ í™”ë©´ -->
    <canvas id="game" width="960" height="540" aria-label="ê²Œì„ ìº”ë²„ìŠ¤"></canvas>

    <!-- HUD & ì»¨íŠ¸ë¡¤ -->
    <div class="hud">
      <div class="row" style="justify-content:space-between;">
        <div class="panel stats" id="statsPanel">
          <span class="label">ì ìˆ˜</span><span class="pill" id="score">0</span>
          <span class="label">ëª©í‘œ</span><span class="pill" id="target">100</span>
          <span class="label">ì‹œê°„</span><span class="pill" id="time">60.0</span>
          <span class="label">í­íƒ„</span><span class="pill bomb-pill" id="bombs">3</span>
        </div>
        <div class="buttons panel">
          <button id="startBtn">ì‹œì‘</button>
          <button id="restartBtn">ì¬ì‹œì‘</button>
        </div>
      </div>
    </div>

    <!-- ì‹œì‘/ê²°ê³¼ ì˜¤ë²„ë ˆì´ -->
    <div class="overlay" id="overlay">
      <div class="title">ì™¸ê³„ë¥¼ ìœ„í•´ í¬ìƒí•˜ë¼</div>
      <div class="subtitle">ì¥ë¥´: ìŠˆíŒ… Â· í”½ì…€ ì•„íŠ¸ Â· ì€í•˜ìˆ˜ ë°°ê²½</div>
      <div class="panel" style="max-width:640px;">
        <div class="big" style="margin-bottom:10px;">ì¡°ì‘ ë°©ë²•</div>
        <div style="display:flex; justify-content:center; gap:10px; flex-wrap:wrap;">
          <span class="kbd">â† â†‘ â†“ â†’</span> <span>ì´ë™</span>
          <span class="kbd">Space</span> <span>ì´ ì˜ê¸°</span>
          <span class="kbd">A</span> <span>í­íƒ„</span>
        </div>
      </div>
      <div class="buttons">
        <button id="overlayStart">ì‹œì‘ ë²„íŠ¼ í´ë¦­</button>
      </div>
      <div style="font-size:11px; opacity:.8;">ì§€êµ¬ì¸ì„ ë§ì¶œ ë•Œë§ˆë‹¤ +5ì  Â· ëª©í‘œ ì ìˆ˜ ë„ë‹¬ ì‹œ ìŠ¹ë¦¬ Â· ì‹œê°„ì´ ëë‚˜ë©´ íŒ¨ë°°</div>
    </div>
  </div>

  <script>
  // ============================================================
  //  ì™¸ê³„ë¥¼ ìœ„í•´ í¬ìƒí•˜ë¼ â€” HTML5 Canvas ìŠˆíŒ… ê²Œì„
  //  ìš”êµ¬ ì‚¬í•­ ë°˜ì˜ ëª©ë¡:
  //   â€¢ ì¡°ì‘: ë°©í–¥í‚¤(ì´ë™), Space(ì´), A(í­íƒ„)
  //   â€¢ ì‹œì‘ ë²„íŠ¼ìœ¼ë¡œ ì‹œì‘, ì¬ì‹œì‘ ë²„íŠ¼ ì œê³µ
  //   â€¢ ëª©í‘œ: ì§€êµ¬ì¸ ë§ì¶”ê¸° / ìŠ¹ë¦¬: ì¼ì • ì ìˆ˜(ê¸°ë³¸ 100) ë„ë‹¬
  //   â€¢ ê²Œì„ì˜¤ë²„: ì œí•œ ì‹œê°„ ì¢…ë£Œ
  //   â€¢ ì ìˆ˜: ì§€êµ¬ì¸ 1ëª… ë‹¹ 5ì 
  //   â€¢ ë‚œì´ë„: ì‹œê°„ì´ ì§€ë‚ ìˆ˜ë¡ â€˜ì›€ì§ì„ì´ ëŠë ¤ì§â€™ (í”Œë ˆì´ì–´Â·ì  ëª¨ë‘ ì†ë„ ì†Œí­ í•˜í–¥)
  //   â€¢ ë””ìì¸: í”½ì…€ ì•„íŠ¸ ê°ì„±, ì€í•˜ìˆ˜(ìŠ¤íƒ€í•„ë“œ) ë°°ê²½, í­ë°œ ì´í™íŠ¸
  //   â€¢ íš¨ê³¼ìŒ: ê°„ë‹¨í•œ Web Audio ë¹„í”„/í‘ ì‚¬ìš´ë“œ
  // ============================================================

  // â€”â€” ìº”ë²„ìŠ¤/ì»¨í…ìŠ¤íŠ¸ â€”â€”
  const cvs = document.getElementById('game');
  const ctx = cvs.getContext('2d');
  ctx.imageSmoothingEnabled = false; // í”½ì…€ ëŠë‚Œ ìœ ì§€

  // â€”â€” HUD ì—˜ë¦¬ë¨¼íŠ¸ â€”â€”
  const elScore = document.getElementById('score');
  const elTarget = document.getElementById('target');
  const elTime = document.getElementById('time');
  const elBombs = document.getElementById('bombs');
  const startBtn = document.getElementById('startBtn');
  const restartBtn = document.getElementById('restartBtn');
  const overlay = document.getElementById('overlay');
  const overlayStart = document.getElementById('overlayStart');

  // â€”â€” ì˜¤ë””ì˜¤: ê°„ë‹¨ íš¨ê³¼ìŒ ìƒì„±ê¸° â€”â€”
  const AudioCtx = window.AudioContext || window.webkitAudioContext;
  const actx = new AudioCtx();
  const playBeep = (freq=440, dur=0.06, type='square', gain=0.05)=>{
    const o = actx.createOscillator();
    const g = actx.createGain();
    o.type = type; o.frequency.value = freq; g.gain.value = gain; o.connect(g); g.connect(actx.destination);
    o.start(); o.stop(actx.currentTime + dur);
  };
  const sShoot = ()=> playBeep(840, .05, 'square', 0.04);
  const sExpl  = ()=> playBeep(110, .18, 'sawtooth', 0.06);
  const sWin   = ()=> playBeep(660, .1, 'square', 0.06);
  const sLose  = ()=> playBeep(220, .2, 'triangle', 0.05);
  const sPickup= ()=> playBeep(1200, .06, 'square', 0.04);

  // â€”â€” ê²Œì„ ìƒíƒœ â€”â€”
  const state = {
    running: false,
    score: 0,
    targetScore: 1000,    // ìŠ¹ë¦¬ ëª©í‘œ ì ìˆ˜
    timeLimit: 200,       // ì œí•œ ì‹œê°„(ì´ˆ)
    timeLeft: 60,
    bombs: 3,            // ë³´ìœ  í­íƒ„ ìˆ˜
    lastTime: 0,
    keys: {},
  };
  elTarget.textContent = state.targetScore;

  // â€”â€” ë‚œì´ë„(ì‹œê°„ ê²½ê³¼ì— ë”°ë¥¸ ê°ì†) â€”â€”
  function difficultySlowdown(){
    // 0ì´ˆâ†’1.0, 60ì´ˆâ†’0.8 (ì„ í˜•), ë„ˆë¬´ ë‹µë‹µí•˜ì§€ ì•Šê²Œ ì‚´ì§ë§Œ ëŠë ¤ì§
    const t = Math.max(0, Math.min(1, 1 - state.timeLeft / state.timeLimit));
    return 1 - 0.2 * t; // 1.0 â†’ 0.8
  }

  // â€”â€” ì—”í‹°í‹° ì»¨í…Œì´ë„ˆ â€”â€”
  const player = { x: cvs.width/2, y: cvs.height - 80, w: 16, h: 16, speed: 240 };
  let bullets = [];
  let enemies = [];
  let particles = [];
  let pickups = []; // í­íƒ„ ì•„ì´í…œ

  // â€”â€” ìœ í‹¸ â€”â€”
  const rand = (a,b)=> a + Math.random()*(b-a);
  const clamp = (v,a,b)=> Math.max(a, Math.min(b, v));

  // â€”â€” ì…ë ¥ â€”â€”
  addEventListener('keydown', (e)=>{ state.keys[e.key.toLowerCase()] = true; if(actx.state==='suspended') actx.resume(); });
  addEventListener('keyup',   (e)=>{ state.keys[e.key.toLowerCase()] = false; });

  // â€”â€” ë²„íŠ¼ â€”â€”
  function startGame(){
    resetGame();
    overlay.style.display='none';
    state.running = true;
    state.lastTime = performance.now();
    requestAnimationFrame(loop);
  }
  function resetGame(){
    state.score = 0; elScore.textContent = state.score;
    state.timeLeft = state.timeLimit; elTime.textContent = state.timeLeft.toFixed(1);
    state.bombs = 3; elBombs.textContent = state.bombs;
    player.x = cvs.width/2; player.y = cvs.height - 80;
    bullets.length = 0; enemies.length = 0; particles.length = 0; pickups.length = 0;
    spawnInitial();
  }
  startBtn.onclick = startGame; overlayStart.onclick = startGame;
  restartBtn.onclick = ()=>{ startGame(); };

  // â€”â€” ìŠ¤í° ë¡œì§ â€”â€”
  let enemySpawnTimer = 0;
  function spawnEnemy(){
    // ì (ì§€êµ¬ì¸): ìƒë‹¨ì—ì„œ ì•„ë˜ë¡œ, í˜¹ì€ ì¢Œìš°ì—ì„œ ì‚¬ì„ ìœ¼ë¡œ ë“±ì¥
    const edge = Math.random();
    let x,y,vx,vy;
    if(edge < 0.6){ // ìƒë‹¨
      x = rand(20, cvs.width-20); y = -20; vx = rand(-20,20); vy = rand(40,80);
    } else if(edge < 0.8){ // ì¢Œì¸¡
      x = -20; y = rand(40, cvs.height*0.6); vx = rand(60,110); vy = rand(10,40);
    } else { // ìš°ì¸¡
      x = cvs.width+20; y = rand(40, cvs.height*0.6); vx = rand(-110,-60); vy = rand(10,40);
    }
    enemies.push({x,y,vx,vy,w:14,h:14,hp:1, t:0});
  }
  function spawnInitial(){
    for(let i=0;i<10;i++) spawnEnemy();
  }
  function maybeSpawnPickup(dt){
    // í™•ë¥ ì ìœ¼ë¡œ í­íƒ„ ì•„ì´í…œ ë“œë¡­(ìƒë‹¨ì—ì„œ í•˜ê°•)
    if(Math.random() < 0.005 * dt){
      pickups.push({x:rand(20,cvs.width-20), y:-10, vy:50, w:12, h:12});
    }
  }

  // â€”â€” ì´ì•Œ/í­íƒ„ â€”â€”
  let shootCooldown = 0;
  function tryShoot(){
    if(shootCooldown>0) return;
    bullets.push({x:player.x, y:player.y-12, vx:0, vy:-360, w:3, h:6});
    sShoot();
    shootCooldown = 0.18; // ì—°ì‚¬ ì œí•œ
  }
  function useBomb(){
    if(state.bombs<=0) return;
    state.bombs--; elBombs.textContent = state.bombs;
    // í™”ë©´ ì „ì²´ í­ë°œ: ì  ëª¨ë‘ ì²˜ì¹˜ + íŒŒí¸ ìƒì„±
    enemies.forEach(e=>{
      makeExplosion(e.x, e.y, 18);
      state.score += 5; // ì  1ëª… = 5ì 
    });
    enemies.length = 0;
    sExpl(); sExpl();
  }

  // â€”â€” í­ë°œ íŒŒí‹°í´ â€”â€”
  function makeExplosion(x,y, n=12){
    for(let i=0;i<n;i++){
      const a = Math.random()*Math.PI*2;
      const sp = rand(60,160);
      particles.push({x,y, vx:Math.cos(a)*sp, vy:Math.sin(a)*sp, life:rand(.3,.8)});
    }
  }

  // â€”â€” ì¶©ëŒ â€”â€”
  function hit(a,b){
    return Math.abs(a.x-b.x) < (a.w+b.w)/2 && Math.abs(a.y-b.y) < (a.h+b.h)/2;
  }

  // â€”â€” ë°°ê²½(ì€í•˜ìˆ˜/ìŠ¤íƒ€í•„ë“œ) â€”â€”
  const stars = Array.from({length:140},()=>({x:Math.random()*cvs.width, y:Math.random()*cvs.height, z: rand(0.2,1)}));
  function drawBackground(dt){
    // ë³„ ì´ë™ (ëŠë¦° íŒ¨ëŸ´ë™ìŠ¤)
    for(const s of stars){ s.y += 8 * s.z * dt; if(s.y>cvs.height) { s.y = -2; s.x = Math.random()*cvs.width; } }
    ctx.fillStyle = '#000'; ctx.fillRect(0,0,cvs.width,cvs.height);
    for(const s of stars){
      const size = Math.ceil(s.z*2);
      ctx.fillStyle = `rgba(${Math.floor(120+80*s.z)},${Math.floor(160+70*s.z)},255,${0.7*s.z})`;
      ctx.fillRect(Math.round(s.x), Math.round(s.y), size, size);
    }
    // ì€í•˜ìˆ˜ íë¦„
    ctx.globalAlpha = 0.08; ctx.fillStyle = '#17294f';
    for(let i=0;i<6;i++) ctx.fillRect(0, (i*90 + (performance.now()/1200)%90)-90, cvs.width, 50);
    ctx.globalAlpha = 1;
  }

  // â€”â€” ê·¸ë¦¬ê¸°(í”½ì…€ ë¸”ë¡ìœ¼ë¡œ ê°„ë‹¨ ë„íŠ¸) â€”â€”
  function drawPlayer(){
    const {x,y} = player; ctx.save(); ctx.translate(Math.round(x), Math.round(y));
    // ì™¸ê³„ì¸(ì£¼ì¸ê³µ) â€” ë„íŠ¸ ë¸”ë¡
    ctx.fillStyle = '#8ef9a5'; // ëª¸ì²´
    ctx.fillRect(-8,-8,16,16);
    ctx.fillStyle = '#16261f'; // ëˆˆ
    ctx.fillRect(-4,-2,3,3); ctx.fillRect(1,-2,3,3);
    ctx.fillStyle = '#3affd2'; // ì¥ì‹
    ctx.fillRect(-2,4,4,2);
    ctx.restore();
  }
  function drawEnemy(e){
    ctx.save(); ctx.translate(Math.round(e.x), Math.round(e.y));
    // ì§€êµ¬ì¸ â€” íŒŒë€ í—¬ë©§ + ë…¸ë‘ ë³µì¥
    ctx.fillStyle = '#3aa0ff'; ctx.fillRect(-7,-9,14,7); // í—¬ë©§
    ctx.fillStyle = '#ffd166'; ctx.fillRect(-6,-2,12,12); // ëª¸í†µ
    ctx.fillStyle = '#0d1b2a'; ctx.fillRect(-3,0,2,3); ctx.fillRect(1,0,2,3); // ë‹¤ë¦¬
    ctx.restore();
  }
  function drawBullet(b){ ctx.fillStyle='#afffff'; ctx.fillRect(Math.round(b.x-1), Math.round(b.y-3), 3, 6); }
  function drawPickup(p){ ctx.fillStyle= '#ff4d6d'; ctx.fillRect(Math.round(p.x-6), Math.round(p.y-6), 12, 12); ctx.fillStyle='#fff'; ctx.fillRect(Math.round(p.x-2), Math.round(p.y-2), 4, 4); }
  function drawParticles(dt){
    for(const prt of particles){
      ctx.fillStyle = '#ff7b9a';
      ctx.fillRect(Math.round(prt.x-1), Math.round(prt.y-1), 2, 2);
    }
  }

  // â€”â€” ì—…ë°ì´íŠ¸ â€”â€”
  function update(dt){
    // ì´ë™ ì†ë„ ê°ì† ê³„ìˆ˜
    const slow = difficultySlowdown();

    // í”Œë ˆì´ì–´ ì´ë™
    const sp = player.speed * slow;
    let vx=0, vy=0;
    if(state.keys['arrowleft']||state.keys['a']) vx -= 1; // WASD ì¤‘ AëŠ” í­íƒ„ê³¼ ê²¹ì¹˜ë‹ˆ í™”ì‚´í‘œ ê¶Œì¥. ê·¸ë˜ë„ ì´ë™ìœ¼ë¡œë„ í—ˆìš©.
    if(state.keys['arrowright']||state.keys['d']) vx += 1;
    if(state.keys['arrowup']||state.keys['w']) vy -= 1;
    if(state.keys['arrowdown']||state.keys['s']) vy += 1;
    const len = Math.hypot(vx,vy)||1;
    player.x = clamp(player.x + (vx/len)*sp*dt, 12, cvs.width-12);
    player.y = clamp(player.y + (vy/len)*sp*dt, 12, cvs.height-12);

    // ì´ì•Œ ë°œì‚¬
    if(state.keys[' ']||state.keys['space']) tryShoot();

    // í­íƒ„ ì‚¬ìš© (í‚¤: a)
    if(state.keys['a'] && !state.keys.__bombLatch){ useBomb(); state.keys.__bombLatch=true; }
    if(!state.keys['a']) state.keys.__bombLatch=false;

    // ì¿¨ë‹¤ìš´
    shootCooldown = Math.max(0, shootCooldown - dt);

    // ì´ì•Œ ì´ë™
    bullets.forEach(b=>{ b.x += b.vx*dt; b.y += b.vy*dt; });
    bullets = bullets.filter(b=> b.y>-20 && b.y<cvs.height+20 && b.x>-20 && b.x<cvs.width+20);

    // ì  ìŠ¤í° & ì´ë™
    enemySpawnTimer -= dt;
    if(enemySpawnTimer<=0){ enemySpawnTimer = rand(0.4, 0.9); spawnEnemy(); }
    for(const e of enemies){ e.t += dt; e.x += e.vx*slow*dt; e.y += e.vy*slow*dt; }
    enemies = enemies.filter(e=> e.x>-40 && e.x<cvs.width+40 && e.y<cvs.height+30);

    // í”½ì—…(í­íƒ„) ìŠ¤í°/ì´ë™
    maybeSpawnPickup(dt);
    for(const p of pickups){ p.y += p.vy*dt; }
    pickups = pickups.filter(p=> p.y < cvs.height+20);

    // ì¶©ëŒ: ì´ì•Œ â†” ì 
    for(const b of bullets){
      for(const e of enemies){
        if(hit(b,e)){
          e.hp = 0; b.dead = true; state.score += 5; elScore.textContent = state.score; makeExplosion(e.x,e.y,12); sExpl();
        }
      }
    }
    bullets = bullets.filter(b=> !b.dead);
    enemies = enemies.filter(e=> e.hp>0);

    // ì¶©ëŒ: í”Œë ˆì´ì–´ â†” í”½ì—…
    for(const p of pickups){
      if(hit(p, player)){
        state.bombs = Math.min(9, state.bombs+1); elBombs.textContent = state.bombs; p.dead = true; sPickup();
      }
    }
    pickups = pickups.filter(p=> !p.dead);

    // íŒŒí‹°í´ ì—…ë°ì´íŠ¸
    for(const prt of particles){ prt.x += prt.vx*dt; prt.y += prt.vy*dt; prt.life -= dt; }
    particles = particles.filter(p=> p.life>0);

    // ì‹œê°„ ê²½ê³¼
    state.timeLeft = Math.max(0, state.timeLeft - dt);
    elTime.textContent = state.timeLeft.toFixed(1);

    // ìŠ¹ë¦¬/íŒ¨ë°° ì²´í¬
    if(state.score >= state.targetScore){
      endGame(true);
    } else if(state.timeLeft <= 0){
      endGame(false);
    }
  }

  // â€”â€” ë Œë” â€”â€”
  function render(dt){
    drawBackground(dt);
    // ì—”í‹°í‹°
    drawPlayer();
    for(const b of bullets) drawBullet(b);
    for(const e of enemies) drawEnemy(e);
    for(const p of pickups) drawPickup(p);
    drawParticles(dt);

    // ë°”ë‹¥ ë¼ì¸(ì‚´ì§ ë ˆíŠ¸ë¡œ ëŠë‚Œ ë””í…Œì¼)
    ctx.globalAlpha = .2; ctx.fillStyle = '#274472'; ctx.fillRect(0, cvs.height-2, cvs.width, 2); ctx.globalAlpha = 1;
  }

  // â€”â€” ê²Œì„ ë£¨í”„ â€”â€”
  function loop(now){
    if(!state.running) return;
    const dt = Math.min(0.033, (now - state.lastTime)/1000 || 0.016);
    state.lastTime = now;
    update(dt); render(dt);
    requestAnimationFrame(loop);
  }

  // â€”â€” ì¢…ë£Œ ì²˜ë¦¬ â€”â€”
  function endGame(win){
    state.running = false;
    overlay.style.display='flex';
    overlay.innerHTML = '';

    const title = document.createElement('div');
    title.className = 'title '+(win?'win':'lose');
    title.textContent = win ? 'ìŠ¹ë¦¬! ëª©í‘œ ì ìˆ˜ ë‹¬ì„±' : 'ì‹œê°„ ì¢…ë£Œ â€” íŒ¨ë°°!';

    const sub = document.createElement('div');
    sub.className = 'subtitle';
    sub.innerHTML = `ì ìˆ˜: <span style="color:var(--ui-ac)">${state.score}</span> / ëª©í‘œ: ${state.targetScore}`;

    const tip = document.createElement('div'); tip.style.fontSize='11px'; tip.style.opacity='.85';
    tip.innerHTML = win ? 'ë©‹ì ¸ìš”! ì§€êµ¬ì¸ì€ ëª¨ë‘ ë–¨ê³  ìˆì–´ìš” ğŸ‘½' : 'ë‹¤ìŒì—” ë” ë¹¨ë¦¬ ì›€ì§ì—¬ë³´ìâ€¦ ì•„ë‹ˆ, ëŠë ¤ì§€ë‹ˆ ë” ì˜ë¦¬í•˜ê²Œ!';

    const buttons = document.createElement('div'); buttons.className='buttons';
    const again = document.createElement('button'); again.textContent = 'ì¬ì‹œì‘';
    again.onclick = startGame;
    const quit = document.createElement('button'); quit.textContent = 'ì²˜ìŒ í™”ë©´';
    quit.onclick = ()=>{ resetGame(); showStartOverlay(); };
    buttons.append(again, quit);

    const panel = document.createElement('div'); panel.className='panel'; panel.style.maxWidth='640px';
    const help = document.createElement('div'); help.innerHTML = '<span class="kbd">Space</span> ì´ì•Œ Â· <span class="kbd">A</span> í­íƒ„ Â· ì§€êµ¬ì¸ ëª…ì¤‘ ì‹œ +5ì ';
    panel.append(help);

    overlay.append(title, sub, buttons, panel);

    if(win) sWin(); else sLose();
  }

  function showStartOverlay(){
    overlay.style.display='flex';
    overlay.innerHTML = `
      <div class="title">ì™¸ê³„ë¥¼ ìœ„í•´ í¬ìƒí•˜ë¼</div>
      <div class="subtitle">ì¥ë¥´: ìŠˆíŒ… Â· í”½ì…€ ì•„íŠ¸ Â· ì€í•˜ìˆ˜ ë°°ê²½</div>
      <div class="panel" style="max-width:640px;">
        <div class="big" style="margin-bottom:10px;">ì¡°ì‘ ë°©ë²•</div>
        <div style="display:flex; justify-content:center; gap:10px; flex-wrap:wrap;">
          <span class="kbd">â† â†‘ â†“ â†’</span> <span>ì´ë™</span>
          <span class="kbd">Space</span> <span>ì´ ì˜ê¸°</span>
          <span class="kbd">A</span> <span>í­íƒ„</span>
        </div>
      </div>
      <div class="buttons">
        <button id="overlayStart">ì‹œì‘ ë²„íŠ¼ í´ë¦­</button>
      </div>
      <div style="font-size:11px; opacity:.8;">ì§€êµ¬ì¸ì„ ë§ì¶œ ë•Œë§ˆë‹¤ +5ì  Â· ëª©í‘œ ì ìˆ˜ ë„ë‹¬ ì‹œ ìŠ¹ë¦¬ Â· ì‹œê°„ì´ ëë‚˜ë©´ íŒ¨ë°°</div>
    `;
    overlay.querySelector('#overlayStart').onclick = startGame;
  }

  // ì§„ì… ì‹œ ì²« í™”ë©´
  showStartOverlay();

  // ì²˜ìŒì— ê°€ë³ê²Œ ë Œë”(ì •ì§€ í™”ë©´)
  (function initialDraw(){ drawBackground(0); drawPlayer(); })();

  </script>
</body>
</html>
