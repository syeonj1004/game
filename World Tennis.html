<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>World Tennis</title>
  <style>
    body {
      margin: 0;
      background: #2ecc71;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    canvas {
      background: #1e8449; /* 테니스장 배경색 */
      display: block;
      margin-top: 20px;
      border: 3px solid #000;
    }
    #scoreboard {
      font-size: 24px;
      font-weight: bold;
      margin-top: 10px;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>World Tennis</h1>
  <button onclick="startGame()">게임 시작</button>
  <canvas id="gameCanvas" width="600" height="400"></canvas>
  <div id="scoreboard">Player: 0 | CPU: 0</div>
  <button onclick="restartGame()">재시작</button>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // 캐릭터 설정 (사람 형태 + 라켓)
    let player = { x: 60, y: canvas.height/2 - 50, width: 20, height: 80, color: "#3498db", dy: 0, dx: 0 };
    let cpu = { x: canvas.width - 80, y: canvas.height/2 - 50, width: 20, height: 80, color: "#e74c3c" };
    let ball = { x: canvas.width/2, y: canvas.height/2, radius: 8, dx: 3, dy: 2 }; // 공 속도 조금 낮춤

    let playerScore = 0;
    let cpuScore = 0;
    let gameRunning = false;

    document.addEventListener("keydown", keyDownHandler);
    document.addEventListener("keyup", keyUpHandler);

    function startGame(){
      gameRunning = true;
      resetBall();
      gameLoop();
    }

    function restartGame(){
      playerScore = 0;
      cpuScore = 0;
      updateScore();
      resetBall();
      gameRunning = true;
    }

    function keyDownHandler(e){
      if(e.key === "ArrowUp"){
        player.dy = -5;
      } else if(e.key === "ArrowDown"){
        player.dy = 5;
      } else if(e.key === "ArrowLeft"){
        player.dx = -5;
      } else if(e.key === "ArrowRight"){
        player.dx = 5;
      } else if(e.key === "s" || e.key === "S"){
        // 샷 기능 (스피드업)
        ball.dx *= 1.2;
        ball.dy *= 1.2;
      }
    }

    function keyUpHandler(e){
      if(e.key === "ArrowUp" || e.key === "ArrowDown"){
        player.dy = 0;
      }
      if(e.key === "ArrowLeft" || e.key === "ArrowRight"){
        player.dx = 0;
      }
    }

    function resetBall(){
      ball.x = canvas.width/2;
      ball.y = canvas.height/2;
      ball.dx = Math.random() > 0.5 ? 3 : -3; // 속도 낮게 시작
      ball.dy = (Math.random() * 2) - 1;
    }

    function updateScore(){
      document.getElementById("scoreboard").innerText = `Player: ${playerScore} | CPU: ${cpuScore}`;
      if(playerScore >= 4){
        alert("🎉 플레이어 승리!");
        gameRunning = false;
      } else if(cpuScore >= 4){
        alert("😢 CPU 승리!");
        gameRunning = false;
      }
    }

    // 캐릭터 그리기 (몸 + 머리 + 라켓)
    function drawCharacter(char, isPlayer){
      ctx.fillStyle = char.color;
      ctx.fillRect(char.x, char.y, char.width, char.height); // 몸통

      // 머리
      ctx.beginPath();
      ctx.arc(char.x + char.width/2, char.y - 10, 15, 0, Math.PI*2);
      ctx.fill();

      // 라켓 (타원형 + 손잡이)
      ctx.fillStyle = "#f1c40f";
      ctx.strokeStyle = "#f1c40f";
      if(isPlayer){
        ctx.fillRect(char.x + char.width, char.y + 25, 5, 30); // 손잡이
        ctx.beginPath();
        ctx.ellipse(char.x + char.width + 20, char.y + 40, 12, 20, 0, 0, Math.PI*2);
        ctx.stroke();
      } else {
        ctx.fillRect(char.x - 5, char.y + 25, 5, 30); // 손잡이
        ctx.beginPath();
        ctx.ellipse(char.x - 20, char.y + 40, 12, 20, 0, 0, Math.PI*2);
        ctx.stroke();
      }
    }

    function gameLoop(){
      if(!gameRunning) return;

      ctx.clearRect(0,0,canvas.width,canvas.height);

      // 테니스장 라인
      ctx.strokeStyle = "white";
      ctx.lineWidth = 2;
      ctx.strokeRect(20, 20, canvas.width-40, canvas.height-40);
      ctx.beginPath();
      ctx.moveTo(canvas.width/2, 20);
      ctx.lineTo(canvas.width/2, canvas.height-20);
      ctx.stroke();

      // 플레이어 이동 (중간선까지만 앞으로 이동 가능)
      player.y += player.dy;
      player.x += player.dx;

      if(player.y < 20) player.y = 20;
      if(player.y > canvas.height - player.height - 20) player.y = canvas.height - player.height - 20;
      if(player.x < 20) player.x = 20;
      if(player.x + player.width > canvas.width/2 - 20){
        player.x = canvas.width/2 - 20 - player.width; // 중간선 앞까지만 이동 제한
      }

      // 캐릭터 그리기
      drawCharacter(player, true);
      drawCharacter(cpu, false);

      // 공 그리기
      ctx.fillStyle = "white";
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI*2);
      ctx.fill();

      // 공 움직이기
      ball.x += ball.dx;
      ball.y += ball.dy;

      // 벽 충돌 (테니스장 경계)
      if(ball.y - ball.radius < 20 || ball.y + ball.radius > canvas.height-20){
        ball.dy *= -1;
      }

      // 플레이어 충돌
      if(ball.x - ball.radius < player.x + player.width && ball.y > player.y && ball.y < player.y + player.height){
        ball.dx *= -1;
      }

      // CPU 충돌 (반응 느리게)
      if(ball.x + ball.radius > cpu.x && ball.y > cpu.y && ball.y < cpu.y + cpu.height){
        ball.dx *= -1;
      }

      // 점수 처리
      if(ball.x - ball.radius < 0){
        cpuScore++;
        updateScore();
        resetBall();
      }
      if(ball.x + ball.radius > canvas.width){
        playerScore++;
        updateScore();
        resetBall();
      }

      // CPU 움직임 (반응 느리게 해서 못하게 만듦)
      let cpuCenter = cpu.y + cpu.height/2;
      if(cpuCenter < ball.y - 30){
        cpu.y += 2; // 속도 낮춤
      } else if(cpuCenter > ball.y + 30){
        cpu.y -= 2;
      }

      requestAnimationFrame(gameLoop);
    }
  </script>
</body>
</html>
