<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>World Tennis</title>
  <style>
    body {
      margin: 0;
      background: #2ecc71;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    canvas {
      background: #1e8449; /* í…Œë‹ˆìŠ¤ì¥ ë°°ê²½ìƒ‰ */
      display: block;
      margin-top: 20px;
      border: 3px solid #000;
    }
    #scoreboard {
      font-size: 24px;
      font-weight: bold;
      margin-top: 10px;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 18px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>World Tennis</h1>
  <button onclick="startGame()">ê²Œì„ ì‹œì‘</button>
  <canvas id="gameCanvas" width="600" height="400"></canvas>
  <div id="scoreboard">Player: 0 | CPU: 0</div>
  <button onclick="restartGame()">ì¬ì‹œì‘</button>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    // ìºë¦­í„° ì„¤ì • (ì‚¬ëŒ í˜•íƒœ + ë¼ì¼“)
    let player = { x: 60, y: canvas.height/2 - 50, width: 20, height: 80, color: "#3498db", dy: 0, dx: 0 };
    let cpu = { x: canvas.width - 80, y: canvas.height/2 - 50, width: 20, height: 80, color: "#e74c3c" };
    let ball = { x: canvas.width/2, y: canvas.height/2, radius: 8, dx: 3, dy: 2 }; // ê³µ ì†ë„ ì¡°ê¸ˆ ë‚®ì¶¤

    let playerScore = 0;
    let cpuScore = 0;
    let gameRunning = false;

    document.addEventListener("keydown", keyDownHandler);
    document.addEventListener("keyup", keyUpHandler);

    function startGame(){
      gameRunning = true;
      resetBall();
      gameLoop();
    }

    function restartGame(){
      playerScore = 0;
      cpuScore = 0;
      updateScore();
      resetBall();
      gameRunning = true;
    }

    function keyDownHandler(e){
      if(e.key === "ArrowUp"){
        player.dy = -5;
      } else if(e.key === "ArrowDown"){
        player.dy = 5;
      } else if(e.key === "ArrowLeft"){
        player.dx = -5;
      } else if(e.key === "ArrowRight"){
        player.dx = 5;
      } else if(e.key === "s" || e.key === "S"){
        // ìƒ· ê¸°ëŠ¥ (ìŠ¤í”¼ë“œì—…)
        ball.dx *= 1.2;
        ball.dy *= 1.2;
      }
    }

    function keyUpHandler(e){
      if(e.key === "ArrowUp" || e.key === "ArrowDown"){
        player.dy = 0;
      }
      if(e.key === "ArrowLeft" || e.key === "ArrowRight"){
        player.dx = 0;
      }
    }

    function resetBall(){
      ball.x = canvas.width/2;
      ball.y = canvas.height/2;
      ball.dx = Math.random() > 0.5 ? 3 : -3; // ì†ë„ ë‚®ê²Œ ì‹œì‘
      ball.dy = (Math.random() * 2) - 1;
    }

    function updateScore(){
      document.getElementById("scoreboard").innerText = `Player: ${playerScore} | CPU: ${cpuScore}`;
      if(playerScore >= 4){
        alert("ğŸ‰ í”Œë ˆì´ì–´ ìŠ¹ë¦¬!");
        gameRunning = false;
      } else if(cpuScore >= 4){
        alert("ğŸ˜¢ CPU ìŠ¹ë¦¬!");
        gameRunning = false;
      }
    }

    // ìºë¦­í„° ê·¸ë¦¬ê¸° (ëª¸ + ë¨¸ë¦¬ + ë¼ì¼“)
    function drawCharacter(char, isPlayer){
      ctx.fillStyle = char.color;
      ctx.fillRect(char.x, char.y, char.width, char.height); // ëª¸í†µ

      // ë¨¸ë¦¬
      ctx.beginPath();
      ctx.arc(char.x + char.width/2, char.y - 10, 15, 0, Math.PI*2);
      ctx.fill();

      // ë¼ì¼“ (íƒ€ì›í˜• + ì†ì¡ì´)
      ctx.fillStyle = "#f1c40f";
      ctx.strokeStyle = "#f1c40f";
      if(isPlayer){
        ctx.fillRect(char.x + char.width, char.y + 25, 5, 30); // ì†ì¡ì´
        ctx.beginPath();
        ctx.ellipse(char.x + char.width + 20, char.y + 40, 12, 20, 0, 0, Math.PI*2);
        ctx.stroke();
      } else {
        ctx.fillRect(char.x - 5, char.y + 25, 5, 30); // ì†ì¡ì´
        ctx.beginPath();
        ctx.ellipse(char.x - 20, char.y + 40, 12, 20, 0, 0, Math.PI*2);
        ctx.stroke();
      }
    }

    function gameLoop(){
      if(!gameRunning) return;

      ctx.clearRect(0,0,canvas.width,canvas.height);

      // í…Œë‹ˆìŠ¤ì¥ ë¼ì¸
      ctx.strokeStyle = "white";
      ctx.lineWidth = 2;
      ctx.strokeRect(20, 20, canvas.width-40, canvas.height-40);
      ctx.beginPath();
      ctx.moveTo(canvas.width/2, 20);
      ctx.lineTo(canvas.width/2, canvas.height-20);
      ctx.stroke();

      // í”Œë ˆì´ì–´ ì´ë™ (ì¤‘ê°„ì„ ê¹Œì§€ë§Œ ì•ìœ¼ë¡œ ì´ë™ ê°€ëŠ¥)
      player.y += player.dy;
      player.x += player.dx;

      if(player.y < 20) player.y = 20;
      if(player.y > canvas.height - player.height - 20) player.y = canvas.height - player.height - 20;
      if(player.x < 20) player.x = 20;
      if(player.x + player.width > canvas.width/2 - 20){
        player.x = canvas.width/2 - 20 - player.width; // ì¤‘ê°„ì„  ì•ê¹Œì§€ë§Œ ì´ë™ ì œí•œ
      }

      // ìºë¦­í„° ê·¸ë¦¬ê¸°
      drawCharacter(player, true);
      drawCharacter(cpu, false);

      // ê³µ ê·¸ë¦¬ê¸°
      ctx.fillStyle = "white";
      ctx.beginPath();
      ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI*2);
      ctx.fill();

      // ê³µ ì›€ì§ì´ê¸°
      ball.x += ball.dx;
      ball.y += ball.dy;

      // ë²½ ì¶©ëŒ (í…Œë‹ˆìŠ¤ì¥ ê²½ê³„)
      if(ball.y - ball.radius < 20 || ball.y + ball.radius > canvas.height-20){
        ball.dy *= -1;
      }

      // í”Œë ˆì´ì–´ ì¶©ëŒ
      if(ball.x - ball.radius < player.x + player.width && ball.y > player.y && ball.y < player.y + player.height){
        ball.dx *= -1;
      }

      // CPU ì¶©ëŒ (ë°˜ì‘ ëŠë¦¬ê²Œ)
      if(ball.x + ball.radius > cpu.x && ball.y > cpu.y && ball.y < cpu.y + cpu.height){
        ball.dx *= -1;
      }

      // ì ìˆ˜ ì²˜ë¦¬
      if(ball.x - ball.radius < 0){
        cpuScore++;
        updateScore();
        resetBall();
      }
      if(ball.x + ball.radius > canvas.width){
        playerScore++;
        updateScore();
        resetBall();
      }

      // CPU ì›€ì§ì„ (ë°˜ì‘ ëŠë¦¬ê²Œ í•´ì„œ ëª»í•˜ê²Œ ë§Œë“¦)
      let cpuCenter = cpu.y + cpu.height/2;
      if(cpuCenter < ball.y - 30){
        cpu.y += 2; // ì†ë„ ë‚®ì¶¤
      } else if(cpuCenter > ball.y + 30){
        cpu.y -= 2;
      }

      requestAnimationFrame(gameLoop);
    }
  </script>
</body>
</html>
