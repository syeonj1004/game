<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>먹보 게임</title>
  <style>
    body {
      margin: 0;
      background: #cce5cc;
      overflow: hidden;
    }
    canvas {
      display: block;
      margin: 0 auto;
      background: #aaddaa;
    }
    #overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      background: rgba(0,0,0,0.5);
      color: white;
      font-size: 2em;
    }
    button {
      font-size: 1em;
      padding: 10px 20px;
      margin-top: 20px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas" width="600" height="400"></canvas>
  <div id="overlay">
    <div id="message">Start (Space 버튼)</div>
    <button onclick="startGame()">Start (Space)</button>
  </div>
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    let player = {x:50, y:200, size:25};
    let apples = [];
    let bombs = [];
    let score = 0;
    let level = 1;
    let speed = 6;
    let hearts = 3;
    let gameInterval;
    let running = false;

    function drawPlayer(){
      // 팩맨 본체
      ctx.fillStyle = 'yellow';
      ctx.beginPath();
      ctx.moveTo(player.x,player.y);
      ctx.arc(player.x, player.y, player.size, 0.25*Math.PI, 1.75*Math.PI, false);
      ctx.closePath();
      ctx.fill();

      // 팩맨 눈 (조금 왼쪽으로 이동)
      ctx.fillStyle = 'black';
      ctx.beginPath();
      ctx.arc(player.x + player.size/5, player.y - player.size/2.5, player.size/6, 0, Math.PI*2);
      ctx.fill();
    }

    function drawApple(item){
      ctx.fillStyle = 'red';
      ctx.beginPath();
      ctx.arc(item.x, item.y, 20, 0, Math.PI*2);
      ctx.fill();
      ctx.fillStyle = 'green';
      ctx.beginPath();
      ctx.ellipse(item.x, item.y-22, 6, 10, Math.PI/4, 0, Math.PI*2);
      ctx.fill();
      ctx.fillStyle = 'rgba(255,255,255,0.6)';
      ctx.beginPath();
      ctx.arc(item.x-7, item.y-5, 5, 0, Math.PI*2);
      ctx.fill();
    }

    function drawBomb(item){
      ctx.fillStyle = 'black';
      ctx.beginPath();
      ctx.arc(item.x, item.y, 20, 0, Math.PI*2);
      ctx.fill();
      ctx.strokeStyle = 'brown';
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(item.x, item.y-20);
      ctx.lineTo(item.x, item.y-30);
      ctx.stroke();
      ctx.fillStyle = 'orange';
      ctx.beginPath();
      ctx.arc(item.x, item.y-35, 6, 0, Math.PI*2);
      ctx.fill();
    }

    function spawnItems(){
      let appleChance = 0.05 * (25 / player.size);
      let bombChance = 0.03 * (25 / player.size);
      if(Math.random()<appleChance) apples.push({x:600,y:Math.random()*400});
      if(Math.random()<bombChance) bombs.push({x:600,y:Math.random()*400});
    }

    function updateItems(){
      apples.forEach(a=>a.x -= speed);
      bombs.forEach(b=>b.x -= speed);
      apples = apples.filter(a=>a.x>0);
      bombs = bombs.filter(b=>b.x>0);
    }

    function detectCollisions(){
      apples.forEach((a,i)=>{
        let dx = a.x - player.x;
        let dy = a.y - player.y;
        if(Math.sqrt(dx*dx+dy*dy) < player.size+20){
          score += 1;
          apples.splice(i,1);
        }
      });
      bombs.forEach((b,i)=>{
        let dx = b.x - player.x;
        let dy = b.y - player.y;
        if(Math.sqrt(dx*dx+dy*dy) < player.size+20){
          hearts -= 1;
          bombs.splice(i,1);
        }
      });
    }

    function drawScore(){
      ctx.fillStyle = 'black';
      ctx.font = '20px Arial';
      ctx.fillText('먹보 게임',10,20); // 게임 제목 좌측 상단에 표시
      ctx.fillText('Score: '+score,10,50);
      ctx.fillText('Level: '+level,10,70);
      ctx.fillText('Hearts: '+hearts,10,90);
    }

    function gameLoop(){
      ctx.clearRect(0,0,600,400);
      drawPlayer();
      spawnItems();
      updateItems();
      apples.forEach(a=>drawApple(a));
      bombs.forEach(b=>drawBomb(b));
      detectCollisions();
      drawScore();

      if(player.x - player.size < 0) player.x = player.size;
      if(player.x + player.size > canvas.width) player.x = canvas.width - player.size;
      if(player.y - player.size < 0) player.y = player.size;
      if(player.y + player.size > canvas.height) player.y = canvas.height - player.size;

      if(hearts<=0){
        endGame('Game Over');
      }
      if(score>=5*level){
        level++;
        player.size *= 1.5;
        levelUp('Level '+(level-1)+' Clear');
      }
    }

    function startGame(){
      score=0;
      hearts=3;
      level=1;
      player.size=25;
      apples=[];
      bombs=[];
      player.x=50;
      player.y=200;
      document.getElementById('overlay').style.display='none';
      running=true;
      clearInterval(gameInterval);
      gameInterval=setInterval(gameLoop,50);
    }

    function endGame(msg){
      clearInterval(gameInterval);
      running=false;
      showMessage(msg, true);
    }

    function levelUp(msg){
      clearInterval(gameInterval);
      running=false;
      showMessage(msg, false);
    }

    function showMessage(msg, isGameOver){
      const overlay=document.getElementById('overlay');
      overlay.style.display='flex';
      if(isGameOver){
        overlay.innerHTML='<div>'+msg+'</div><button onclick="startGame()">Restart</button>';
      } else {
        overlay.innerHTML='<div>'+msg+'</div><button onclick="proceedNextLevel()">Level Up</button>';
      }
    }

    function proceedNextLevel(){
      apples=[];
      bombs=[];
      player.x=50;
      player.y=200;
      document.getElementById('overlay').style.display='none';
      running=true;
      clearInterval(gameInterval);
      gameInterval=setInterval(gameLoop,50);
    }

    document.addEventListener('keydown', e=>{
      if(e.code==='ArrowUp') player.y-=20;
      if(e.code==='ArrowDown') player.y+=20;
      if(e.code==='ArrowLeft') player.x-=20;
      if(e.code==='ArrowRight') player.x+=20;
    });
  </script>
</body>
</html>
